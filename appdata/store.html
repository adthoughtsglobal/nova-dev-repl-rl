<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<meta name="nova-include" content="nova.css material-symbols-rounded">
    <meta name="capabilities" content="contentStore">
	<meta name="nova-icon"
		content="<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='53.37052' height='56.68831' viewBox='0,0,53.37052,56.68831'><g transform='translate(-213.17634,-139.63412)'><g stroke-miterlimit='10'><path d='M241.65962,193.67156c-6.87052,-2.04166 -8.64322,-2.56843 -12.6527,-3.75991c-1.84444,-0.5481 -3.22474,-2.87978 -2.70696,-4.6222c1.16355,-3.91554 5.8018,-19.52399 7.88261,-26.52627c0.62507,-2.10345 2.29388,-3.05157 4.32482,-2.44806c6.93594,2.0611 8.93153,2.65411 12.87469,3.82587c1.74832,0.51953 3.09972,2.46721 2.43655,4.69887c-2.11127,7.10476 -6.66524,22.42961 -7.81665,26.30429c-0.51778,1.74241 -2.31527,3.12977 -4.34235,2.5274z' fill='#ffdd70' stroke='none' stroke-width='NaN'/><path d='M250.20411,192.35095c-6.78528,-2.3092 -8.53598,-2.905 -12.49571,-4.2526c-1.82155,-0.61992 -3.10948,-3.00388 -2.52384,-4.72468c1.31602,-3.86695 6.56207,-19.28176 8.91556,-26.19716c0.70698,-2.07736 2.41165,-2.95938 4.41738,-2.27678c6.84989,2.3312 8.82072,3.00191 12.71495,4.32722c1.72663,0.58761 3.0007,2.58673 2.25063,4.7907c-2.38794,7.01661 -7.53866,22.15133 -8.84096,25.97794c-0.58563,1.7208 -2.43608,3.03668 -4.43802,2.35537z' fill='#68ffee' stroke='none' stroke-width='NaN'/><path d='M239.82626,178.57165c-4.78436,1.76483 -6.0188,2.22018 -8.81085,3.25009c-1.2844,0.47377 -3.15859,-0.05508 -3.69904,-1.05991c-1.21449,-2.25805 -6.05585,-11.25924 -8.22778,-15.29737c-0.65243,-1.21304 -0.17647,-2.30561 1.2378,-2.82729c4.82992,-1.78163 6.21956,-2.29424 8.96543,-3.30711c1.21747,-0.44909 2.89315,-0.0854 3.58536,1.20157c2.20371,4.09722 6.9571,12.93488 8.15892,15.16935c0.54045,1.00483 0.20175,2.34997 -1.20982,2.87067z' fill='#ff816f' stroke='none' stroke-width='NaN'/><path d='M213.17634,189.28601c0,-14.65005 0,-6.12361 0,-14.67304c0,-3.93291 3.7648,-7.99489 7.48016,-7.99489c8.34913,0 23.64486,0 38.57587,0c4.48523,0 7.31449,2.71767 7.31449,7.04825c0,14.78957 0,6.73835 0,15.14636c0,3.72796 -3.02922,7.50974 -7.78782,7.50974c-15.14952,0 -29.84053,0 -38.10254,0c-3.71536,0 -7.48016,-2.71404 -7.48016,-7.03641z' fill='#6179ff' stroke='none' stroke-width='NaN'/><path d='M223.09877,165.70023c0,-13.0152 7.62891,-23.56611 17.03965,-23.56611c9.41073,0 17.03965,10.55091 17.03965,23.56611c0,13.0152 -34.07929,13.0152 -34.07929,0z' fill='none' stroke='#6179ff' stroke-width='5'/></g></g></svg>">
	<title>store</title>
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<style>
		html {
			height: 100%;
			width: 100%;
		}

		body {
			margin: 0;
			padding-bottom: 10px;
		}

		.mains {
			padding-top: 0;
		}

		div,
		dialog {
			animation: up .2s;
		}

		.containdiv {
			animation: up2 .5s;
		}

		@keyframes up {
			from {
				opacity: 0;
			}

			to {
				opacity: 1;
			}
		}

		@keyframes up2 {
			from {
				opacity: 0;
				transform: translateY(5px);
			}

			to {
				opacity: 1;
				transform: none;
			}
		}

		#topse {
			display: flex;
			border-radius: 10px;
			padding-left: 0.3rem;
			background: var(--colors-BG-sub);
			animation: inputslide .3s ease-out;
			transition: .3s ease-out;
		}

		@keyframes inputslide {
			0% {
				transform: translateX(-1rem);
			}

			100% {
				transform: translateX(0rem);
			}
		}

		#topse input {
			flex-grow: 1;
			border: none;
			font-size: var(--font-size-normal);
			outline: none;
			text-overflow: ellipsis;
			color: var(--colors-text-normal);
			background-color: transparent;
			border-radius: 0.5rem;
			width: 38vw;
		}

		#topse button {
			border-radius: 7px;
			border: none;
			cursor: pointer;
			transition: .2s;
			color: #dce9fc;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 0.5rem;
		}

		.installbtnicn {
			font-size: 1.3rem !important;
		}

		small {
			margin-left: 13px;
			display: inline-block;
		}

		.app {
			padding: 4px 9px;
			animation: fa 0.5s;
			border-radius: 11px;
			box-shadow: 0 14px 0px -10px inset limegreen;
			padding-top: 12px;
			background: var(--colors-BG-section);
			color: var(--colors-text-normal);
			border: 2px solid transparent;
			display: flex;
			margin: 10px;
			flex: 1;
			min-width: 118px;
			transition: .2s;
			user-select: none;
			cursor: pointer;
			margin-left: 0px;
			padding-bottom: 16px;
			flex-direction: column;
			flex-wrap: wrap;
		}

		.app:hover {
			box-shadow: 0 0 10px #121212;
			filter: brightness(110%);
			background-color: var(--colors-BG-sub);
		}

		.app h3 {
			margin: 10px 0px;
			margin-bottom: 1px;
			font-weight: normal;
			font-size: var(--font-size-subheading);
		}

		.app .appfes {
			display: inline-block;
		}

		.app .appfes div {
			display: inline-block;
			font-size: var(--font-size-small);
			border: none;
			opacity: 0.5;
			max-width: 81px;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.dostuffwithit {
			display: inline-flex;
			width: fit-content;
			align-items: center;
			justify-content: center;
			gap: 0.3rem;
		}

		.insbtn {
			flex: 1;
			width: 100%;
			margin: 3px 0px;
			border-radius: 5px;
			padding: 5px;
			transition: .5s;
			cursor: pointer;
			background: #43A047;
			border: none;
			color: #ffffff;
		}

		.section {
			padding: 0;
			padding-left: 10px;
			align-items: stretch;
			justify-content: flex-start;
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
		}

		#defapppack {
			margin: 10px 0;
			white-space: normal;
			padding: 0;
			padding-left: 10px;
			justify-content: flex-start;
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(134px, 1fr));
		}

		nav {
			padding: 10px;
			margin-bottom: 18px;
			background-color: #232424;
			display: block;
			text-align: left;
			opacity: 80%;
		}

		.srca {
			opacity: 0.5;
			margin-top: 1em;
			display: block;
			font-size: var(--font-size-small);
		}

		.catonappdiv {
			display: inline-block;
			font-size: var(--font-size-small) !important;
			opacity: 0.5;
			transform: translateY(-2px);
			margin-left: 3px;
		}

		.app p {
			height: 61px;
			width: 80%;
			overflow: hidden;
			word-wrap: break-word;
			line-height: 1.25;
			font-size: var(--font-size-normal);
			border-radius: 5px;
			white-space: normal;
			text-overflow: ellipsis;
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
		}

		.loader {
			width: 80px;
			height: 42px;
			display: block;
			margin: auto;
			padding: 0 8px;
			box-sizing: border-box;
			background: linear-gradient(#323232 0 0) 10% 0/4px 20px, linear-gradient(#323232 0 0) 70% 0/4px 20px, radial-gradient(farthest-side, #83ff8c 90%, #0000) 7% 5px/8px 8px content-box, #0000;
			background-repeat: no-repeat;
			animation: l3 2s infinite cubic-bezier(0, 0, 0.26, 0.65);
		}

		@keyframes l3 {
			25% {
				background-position: 0 0, 100% 100%, 100% calc(100% - 5px)
			}

			50% {
				background-position: 0 100%, 100% 100%, 0 calc(100% - 5px)
			}

			75% {
				background-position: 0 100%, 100% 0, 100% 5px
			}
		}

		@keyframes fa {
			0% {
				opacity: 0;
				transform: translateY(-10px);
			}

			75% {
				opacity: 0.7;
				transform: translateY(5px);
			}

			75% {
				opacity: 1;
				transform: translateY(0px);
			}
		}

		.quote {
			padding: 10px;
			border-radius: 7px;
			width: calc(100% - 22px);
			word-wrap: break-word;
			margin-top: 5px;
			border: 1px solid #414141;
			text-align: center;
		}

		#featured {
			border-radius: 10px;
			overflow: hidden;
			margin: 10px;
			background: var(--colors-BG-section);
			padding: 9px;
			display: flex;
			flex-direction: row;
			gap: 0.8rem;
			max-height: 300px;
		}

		#featured h1 {
			margin: 0;
			margin-bottom: 10px;
		}

		#featured button {
			background: rgba(225, 225, 255, 0.2);
			border: none;
			color: var(--colors-text-high);
			padding: 0.5rem 1rem;
			border-radius: 5px;
			display: flex;
			align-items: center;
			flex-direction: row;
			width: fit-content;
		}

		img#featuredImg {
			object-fit: cover;
			flex: 1;
			width: 0;
		}

		#featuredcontent {
			flex: 1;
		}

		#installer {
			width: 100%;
			height: 100%;
			border: none;
			padding: 20px;
			background: var(--colors-BG-normal);
			color: var(--colors-text-normal);
		}

		.containdiv {
			max-width: 500px;
			margin: auto;
		}

		#installer nav {
			background: none;
			padding: 0;
		}

		#installer h1 {
			display: inline-block;
			width: calc(100% - 110px);
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			width: 0;
			flex: 1;
			margin-bottom: 0.3rem;
		}

		#installer button {
			float: right;
			padding: 5px 15px;
			border: none;
			background: #43A047;
			color: var(--colors-text-normal);
			outline: 0;
			border-radius: 4px;
			width: fit-content;
			cursor: pointer;
			font-family: inherit;
		}

		#installer button:hover {
			background-color: var(--colors-BG-sub);
		}

		.installerappbasedata {
			display: flex;
			flex-direction: row;
		}

		.dostuffwithit button {
			background-color: #43A047 !important;
		}

		.dostuffwithit button:hover {
			background-color: #3c933c;
		}

		.insbtn:hover {
			background-color: #378537;
		}

		#apptheme {
			display: grid;
			width: 100%;
			justify-content: center;
			align-items: center;
			justify-items: center;
			padding: 1rem 0;
			font-size: var(--font-size-subheading);
			background: var(--colors-BG-section);
			border-radius: 5px;
			text-shadow: 0 0 10px BLACK;
		}

		#installer #installerappby {
			display: block;
			opacity: 0.7;
			margin-bottom: 10px;
			font-weight: normal;
		}

		#installer p button {
			float: none;
			background: var(--colors-BG-highlighted);
		}

		nav .material-symbols-rounded {
			width: 21px;
			transform: translate(-2px, 7px) scale(0.8);
			display: inline-block;

		}

		nav b {
			cursor: pointer;
		}

		#installerappdesc {
			margin: 2px 0;
		}

		.deapp {
			display: inline-flex;
			padding: 7px 11px;
			background: var(--colors-BG-section);
			margin: 5px;
			transition: .2s;
			cursor: pointer;
			border-radius: 0.5rem;
			justify-content: flex-start;
			align-items: center;
			gap: 0.3rem;
			;
		}

		.deapp:hover {
			filter: brightness(110%);
			transform: scale(1.05);
		}

		.fade {
			transition: opacity 0.5s ease-in-out;
			opacity: 1;
		}

		.fade.hidden {
			opacity: 0;
		}

		.defappcol {
			width: 1rem;
			aspect-ratio: 1 / 1;
			background-color: #378537;
			display: inline-block;
			border-radius: 0.3rem;
		}

		a.farright {
			opacity: 0.5;
			display: flex;
			align-items: center;
			background: #1f1f1f;
			border-radius: 0.5rem;
			padding: 0.3rem 0.5rem;
			gap: 0.3rem;
			font-size: small;
		}

		a.farright i {
			font-size: 1rem;
		}

		.minisecnav {
			display: flex;
			align-items: center;
			justify-content: flex-start;
			gap: 0.5rem;
			font-size: 1rem;
			margin-top: 1rem;
		}

		.resultapp {
			display: flex;
			align-items: flex-start;
			justify-content: space-between;
			flex-direction: row;
			padding: 0.7rem;
			background: var(--colors-BG-section);
			margin: 0 1rem;
			border-radius: 0.5rem;
			margin-bottom: 0.3rem;
		}

		.resultapp:hover {
			background-color: var(--colors-BG-sub);
		}

		.resultapp b,
		.resultapp p {
			margin: 0;
			font-weight: normal;
		}

		.resultapp p {
			opacity: 0.5;
		}

		.resultapp b {
			font-size: var(--font-size-subheading);
		}

		.resultapp .chevronbtn {
			background-color: var(--colors-BG-highlighted);
			border: 0;
			border-radius: 0.5rem;
			color: var(--colors-text-normal);
			outline: none;
			aspect-ratio: 1 / 1;
			display: flex;
			align-items: center;
		}

		#searchresults {
			margin-bottom: 1rem;
			max-height: 193px;
			overflow-y: auto;
			display: none;
		}

		.searchnores {
			text-align: center;
			opacity: .5;
		}

		.nav {
			display: flex;
			margin: 0 auto;
			width: fit-content;
			margin-bottom: 0.5rem;
			gap: .5rem;
			background: var(--colors-BG-section);
			border-radius: 0.5rem;
			padding: 0.3rem;
		}

		.nav button[active="true"] {
			background: var(--colors-BG-sub);
		}

		.nav button {
			background: transparent;
			color: inherit;
			border-radius: 0.5rem;
			border: 0;
		}

		#themeslist {
			display: flex;
			flex-direction: row;
			gap: 0.5rem;
			margin: 1rem;

			justify-content: flex-start;
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(134px, 1fr))
		}

		.themecolorssing {
			width: 0;
			flex: 1;
			height: 20px;
		}

		.themesing {
			background-color: var(--colors-BG-section);
			padding: 0.5rem;
			border-radius: 0.5rem;
			text-overflow: ellipsis;
			white-space: break-spaces;
			overflow: hidden;
			display: flex;
			flex-direction: column;
			gap: 0.5rem;
		}

		.themeinfodiv {
			display: flex;
			align-items: flex-start;
			justify-content: space-between;
			gap: 0.3rem;
			flex-direction: column;
			width: 0;
			flex: 1;
			overflow-x: hidden;
		}

		.themedetdiv {
			display: flex;
			align-items: flex-start;
			justify-content: space-between;
			flex-direction: row;
			gap: 0.5rem;
		}

		.themedetdiv button {
			display: flex;
			border: 0;

			background-color: var(--colors-special-good);
			color: var(--colors-text-high);
			padding: 0.3rem;
			border-radius: 0.5rem;
		}

		.themecolors {
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
			background-size: cover !important;
			background-position: center !important;
			border-radius: 0.5rem;
		}

		.openablewin {
			display: none;
		}

		path,
		svg {
			border-radius: 0.5rem;
			height: fit-content;
		}

		.themename {
			flex: 1;
			text-overflow: ellipsis;
		}

		.themeauth {
			opacity: 0.5;
			font-size: var(--font-size-small);
		}
	</style>
</head>

<body>
	<div class="nav">
		<button active="true" onclick="openwin('appsmode', this)">
			Apps
		</button>
		<button id="themesmodebtn" onclick="openwin('themesmode', this)">
			Themes
		</button>

		<div id="topse">
			<input placeholder="Search or enter link" id="fesinp" onkeydown="handleEnterKey(event)"
				oninput="updateButtonText()">
			<button id="actionButton" onclick="handleSearchOrInstall(this)">
				<div class="material-symbols-rounded installbtnicn">download</div>
			</button>
		</div>
	</div>
	<div class="mains">
		<div id="searchresults"></div>
		<div id="appsmode" class="openablewin">
			<div id="featured">
				<img id="featuredImg" src="https://i.ibb.co/j9Ycj5Y5/image.png">
				<div id="featuredcontent">
					<h1 id="featuredappname">App name</h1>
					<span class="appby" id="featuredappby">App author</span>
					<p id="featuredappdesc">App description</p>
					<button id="featuredappcta"><span>View</span><i
							class="material-symbols-rounded">arrow_forward</i></button>
				</div>
			</div>
			<div id="sugapps">
				:( unexpected error
			</div>

			<small class="minisecnav">Default Apps <a class="farright"><i class="material-symbols-rounded">info</i>click
					to update</a></small>
			<div id="defapppack">
			</div>

		</div>
		<div id="themesmode" class="openablewin">
			<div id="themeslist"></div>
			<script>
				function openwin(winname, obj) {
					if (winname == "appsmode") {
						document.getElementById("topse").style.display = 'flex';
					} else {
						document.getElementById("topse").style.display = 'none'
					}
					document.querySelectorAll("[active]").forEach((x) => {
						x.setAttribute("active", "false");
					});

					obj.setAttribute("active", 'true');
					const elements = document.getElementsByClassName("openablewin");
					for (let i = 0; i < elements.length; i++) {
						elements[i].style.display = 'none';
					}

					document.getElementById(winname).style.display = 'block';
				}
				const elements = document.getElementsByClassName("openablewin");
				for (let i = 0; i < elements.length; i++) {
					elements[i].style.display = 'none';
				}
				document.getElementById('appsmode').style.display = 'block';

				window.parent.fetch('https://adthoughtsglobal.github.io/Nova-Store/db/themes.json')
					.then(response => response.json())
					.then(data => {
						const container = document.getElementById("themeslist");

						Object.entries(data).forEach(([themeName, themeData]) => {
							const themeContainer = document.createElement('div');
							themeContainer.classList.add("themesing");
							themeContainer.style.border = `1px solid ${themeData.colors["--colors-BG-sub"]}`;

							themeContainer.style.background = `linear-gradient(to bottom right, 
								${themeData.colors["--colors-BG-normal"]} 0%, 
								${themeData.colors["--colors-BG-sub"]} 25%, 
								${themeData.colors["--colors-BG-section"]} 75%, 
								${themeData.colors["--colors-BG-highlighted"]}) 100%`;
							themeContainer.style.color = themeData.colors["--colors-text-normal"];

							const colorsSvg = document.createElement('div');
							colorsSvg.style.background = themeData.wallpaper
								? `url("${themeData.wallpaper}")`
								: themeData.colors["--colors-BG-normal"];

							colorsSvg.classList.add('themecolors');
							const svgNS = "http://www.w3.org/2000/svg";

							const colorsubbg = themeData.colors["--colors-BG-sub"] || "#080808";
							const colorsectionbg = themeData.colors["--colors-BG-section"] || "#090909";
							const colorhighlight = themeData.colors["--colors-BG-highlighted"] || "#512DA8";
							const colorwhite = themeData.colors["--colors-text-high"] || "#FFFFFF";
							const colortext = themeData.colors["--colors-text-normal"] || "#FFFFFF";
							const colorgood = themeData.colors["--colors-special-good"] || "#49AC49";
							const colorbad = themeData.colors["--colors-special-bad"] || "#AC4949";

							const svg = document.createElementNS(svgNS, 'svg');
							svg.setAttribute('version', '1.1');
							svg.setAttribute('xmlns', svgNS);
							svg.setAttribute('width', '186.92934');
							svg.setAttribute('height', '127.61522');
							svg.setAttribute('viewBox', '0 0 186.92934 127.61522');

							const g1 = document.createElementNS(svgNS, 'g');
							g1.setAttribute('transform', 'translate(-146.53533,-116.19239)');

							const g2 = document.createElementNS(svgNS, 'g');
							g2.setAttribute('stroke', 'none');
							g2.setAttribute('stroke-width', 'none');
							g2.setAttribute('stroke-miterlimit', '10');

							const paths = [
								{ d: "M153.33273,232.60246v-110.0906h50v110.0906z", fill: colorsectionbg }, // card section
								{ d: "M153.33273,232.60246v-110.0906h117.15993v110.0906z", fill: colorsectionbg },
								{ d: "M165.64709,197.15912v-13.89422h54.10463v13.89422z", fill: colorhighlight }, // button
								{ d: "M165.75792,153.04796v-16.07118h38.50194v16.07118z", fill: colortext },
								{ d: "M165.44056,166.29708v-8.03559h92.94427v8.03559z", fill: colortext },
								{ d: "M165.44056,176.68927v-8.03559h74.55944v8.03559z", fill: colortext },
								{ d: "M173.17094,193.3994v-6.37479h39.05692v6.37479z", fill: colorgood },
								{ d: "M173.17094,193.3994v-6.37479h39.05692v6.37479z", fill: colorwhite }
							];

							paths.forEach(({ d, fill }) => {
								const path = document.createElementNS(svgNS, 'path');
								path.setAttribute('d', d);
								path.setAttribute('fill', fill);
								path.setAttribute('rx', '10');
								g2.appendChild(path);
							});

							g1.appendChild(g2);
							svg.appendChild(g1);
							colorsSvg.appendChild(svg);

							const themedetdiv = document.createElement('div');
							themedetdiv.classList.add('themedetdiv');

							const infoDiv = document.createElement('div');
							infoDiv.classList.add('themeinfodiv');


							const nameDiv = document.createElement('div');
							nameDiv.classList.add("themename")
							nameDiv.innerText = themeName;
							infoDiv.appendChild(nameDiv);

							themeData.by = themeData.by || 'NovaOS';
							const authdiv = document.createElement('div');
							authdiv.classList.add("themeauth")
							authdiv.innerText = themeData.by;
							infoDiv.appendChild(authdiv);

							themedetdiv.appendChild(infoDiv);

							const instdiv = document.createElement('button');
							instdiv.style.background = themeData.colors["--colors-BG-highlighted"];
							instdiv.style.color = themeData.colors["--colors-text-high"];
							instdiv.style.border = `1px solid ${themeData.colors["--colors-BG-sub"]}`;
							instdiv.innerHTML = `<i
						class="material-symbols-rounded">format_paint</i>`;
							themedetdiv.appendChild(instdiv);

							themeContainer.appendChild(colorsSvg);
							themeContainer.appendChild(themedetdiv);

							themeContainer.addEventListener('click', async () => {
								await window.parent.applyThemeNonVisual(themeData, document);
								window.parent.toast(`Theme pack "${themeName}" applied.`)
							});
							container.appendChild(themeContainer);
						});


					})
					.catch(error => console.error('Error loading themes:', error));
			</script>
		</div>
	</div>

	</div>
	<script src="https://cdn.jsdelivr.net/npm/tinycolor2"></script>


	<dialog id="installer">
		<div class="containdiv">
			<nav>
				<b onclick="document.getElementById('installer').close()"><i
						class="material-symbols-rounded">arrow_back</i>
					Back</b>
			</nav>
			<div id="apptheme">
				Theme
			</div>
			<div class="installerappbasedata">
				<h1 id="installerappname">Loading...</h1>
				<div class="dostuffwithit">
					<button id="openbtn">Open</button>
					<button id="installButton">...</button>
				</div>
			</div>
			<b id="installerappby">...</b>
			<b>Overview</b>
			<p id="installerappdesc">...</p>
		</div>
	</dialog>
	<script defer>
		function getAppNameFromUrl(url) {
			let hostname = new URL(url).hostname;
			hostname = hostname.replace(/^www\./, '');
			let parts = hostname.split('.');
			return parts[0].charAt(0).toUpperCase() + parts[0].slice(1);
		}

		async function installapp(x, appName, obj, method = "icononly") {
			let prefixurl = "";
			if (!x.src.startsWith("http")) {
				prefixurl = "https://adthoughtsglobal.github.io/"
			}
			try {
				if (method == 'icononly') {
					obj.innerHTML = `<div class="material-symbols-rounded installbtnicn">pending</div>`
				} else {
					obj.innerHTML = `Checking...`
				}
				const response = await fetch(prefixurl + x.src);
				const content = await response.text();
				await window.parent.createFile("Apps", appName, "app", content);
				setTimeout(() => {
					if (method == 'icononly') {
						obj.innerHTML = `<div class="material-symbols-rounded installbtnicn">check</div>`;
						setTimeout(() => {
							obj.innerHTML = `<div class="material-symbols-rounded installbtnicn">download</div>`
						}, 1000)
					} else {
						obj.innerHTML = `Update`
					}
				}, 1000)
			} catch (err) {
				setTimeout(() => {
					if (method == 'icononly') {
						obj.innerHTML = `<div class="material-symbols-rounded installbtnicn">sentiment_dissatisfied</div>`;
						setTimeout(() => {
							obj.innerHTML = `<div class="material-symbols-rounded installbtnicn">download</div>`
						}, 1000)
					} else {
						obj.innerHTML = "Failed";
						setTimeout(() => {
							obj.innerHTML = "Update";
						}, 1000)
					}
				}, 1000)
			}

		}

		async function greenflag() {

			initializeLoader();
			await fetchAppData().then(appData => {
				renderSections();
				populateApps(appData);
				populateDefaultApps(window.parent.defAppsList);
			}).catch(error => {
				console.error('Error:', error);
				displayErrorMessage("Failed to fetch data. Please try again later.");
			});
			const data = myWindow?.params?.opener;

			if (data == 'themes') {
				setTimeout(openwin('themesmode', document.getElementById('themesmodebtn')), 500);
			}
		}

		function initializeLoader() {
			document.getElementById("sugapps").innerHTML = `<div class="loader"></div>`;
		}

		async function fetchAppData() {
			return await fetch('https://adthoughtsglobal.github.io/Nova-Store/db/database.json')
				.then(response => {
					if (!response.ok) throw new Error('Network response was not ok');
					return response.json();
				});
		}

		function renderSections() {
			document.getElementById("sugapps").innerHTML = `
        <small>For NovaOS</small>
        <div id="nova-section" class="section"></div>
        <small>Apps</small>
        <div id="apps-section" class="section"></div>`;
		}

		async function populateApps(data) {
			const vdevs = data.vdevs;
			const featured = data.featured;

			data.data.sort((a, b) => Object.keys(a)[0].localeCompare(Object.keys(b)[0]));

			data.data.forEach(appDetails => {
				const appName = appDetails.name;

				const appDiv = createAppDiv(appName, appDetails, vdevs, featured);

				if (featured.appName == appName) {
					document.getElementById("featuredappname").innerText = appName;
					document.getElementById("featuredappby").innerText = appDetails.by;
					document.getElementById("featuredappdesc").innerText = appDetails.ldesc;
					document.getElementById("featuredImg").src = featured.img;
					document.getElementById("featured").setAttribute("onclick", `openappinstr('${appName}', ${JSON.stringify(appDetails)})`);
					document.getElementById("featured").style.backgroundImage = `radial-gradient(circle at 0% 0%, ${appDetails.th}, var(--colors-BG-section))`;
				} else if (appDetails.by === "adthoughtsglobal") {
					document.getElementById("nova-section").appendChild(appDiv);
				} else {
					document.getElementById("apps-section").appendChild(appDiv);
				}
			});
		}

		function createAppDiv(appName, appDetails, vdevs, featured) {
			const appDiv = document.createElement('div');
			appDiv.className = 'app';
			appDiv.setAttribute("onclick", `openappinstr('${appName}', ${JSON.stringify(appDetails)})`);

			appDiv.style.boxShadow = `0 14px 0px -10px inset ${appDetails.th}`;
			const appfesDiv = document.createElement('div');
			appfesDiv.className = 'appfes';
			appfesDiv.id = "appfes-" + appName;

			const h3 = document.createElement('h3');
			h3.textContent = appName;
			appfesDiv.appendChild(h3);

			const appInfoDiv = document.createElement('div');
			appInfoDiv.textContent = appDetails.by;
			appfesDiv.appendChild(appInfoDiv);

			const cat = document.createElement('div');
			cat.setAttribute("class", "material-symbols-rounded catonappdiv");
			cat.textContent = vdevs.includes(appInfoDiv.textContent) ? "verified " : "";
			cat.textContent += appDetails.cat === "game" ? "sports_esports" : "widgets";
			appfesDiv.appendChild(cat);

			appDiv.appendChild(appfesDiv);

			const p = document.createElement('p');
			const appDescItem = appDetails.desc;
			p.textContent = appDescItem ? appDescItem : 'Free NovaOS application.';
			appDiv.appendChild(p);

			return appDiv;
		}

		function populateDefaultApps(defaultApps) {
			defaultApps.forEach(appName => {
				const appDiv = document.createElement('div');
				appDiv.id = "appdiv" + window.parent.genUID();
				appDiv.className = 'deapp';
				appDiv.innerHTML = `<span class='defappcol' style='background-color:${window.parent.stringToPastelColor(appName)};'></span>${appName}`;
				appDiv.setAttribute("onclick", `upddefap('${appName}', '${appDiv.id}')`);
				document.getElementById("defapppack").appendChild(appDiv);
			});
		}

		function displayErrorMessage(message) {
			document.getElementById("sugapps").innerHTML = message;
		}
		async function upddefap(appName, div) {
			div = document.getElementById(div);
			div.style.backgroundColor = "grey";
			var response
			const filePath = "appdata/" + appName + ".html";
			try {
				response = await window.parent.fetch(filePath);
				if (!response.ok) {
					// Set background color to red
					div.style.backgroundColor = "red";

					// Check the HTTP status code and throw an error accordingly
					if (response.status === 404) {
						throw new Error("File not found for " + appName);
					} else if (response.status === 403) {
						throw new Error("Forbidden access for " + appName);
					} else {
						throw new Error("Failed to fetch file for " + appName + ". Status: " + response.status);
					}
				}
			} catch (error) {
				// Handle network errors
				if (error instanceof TypeError || error.name === 'FetchError') {
					// Set background color to red or handle as desired
					div.style.backgroundColor = "red";
					console.error("Network error:", error.message);
					// You can also display a message to the user indicating a network error occurred
				} else {
					// Re-throw other errors
					throw error;
				}
			}

			const fileContent = await response.text();

			await window.parent.createFile("Apps", window.parent.toTitleCase(appName), "app", fileContent);
			console.log(appName + " updated successfully.");
			div.style.backgroundColor = "#1f1f1f";
			div.style.color = "#60ff2f";
		}

		function rotateHue(color, degrees) {
			const dummyElement = document.createElement('div');
			dummyElement.style.color = color;
			dummyElement.style.filter = `hue-rotate(${degrees}deg)`;
			document.body.appendChild(dummyElement);
			const rotatedColor = window.getComputedStyle(dummyElement).color;
			document.body.removeChild(dummyElement);
			return rotatedColor;
		}

		function openappinstr(appName, appDetails) {
			const installButton = document.getElementById("installButton");

			installButton.className = 'insbtn';
			let appald = window.parent.getFileNamesByFolder("Apps")
				.then(appald => {
					try {
						const h3 = document.getElementById("installerappname");
						h3.textContent = appName;
						document.getElementById("installerappby").textContent = "" + appDetails.by;
						const p = document.getElementById("installerappdesc");
						const appDescItem = appDetails?.desc || '';
						const appcatitem = appDetails?.cat || '';
						const applditem = appDetails?.ldesc || '';
						const appthitem = appDetails?.th || '';
						const appqtitem = appDetails?.qt || '';

						document.getElementById("apptheme").innerHTML = ((appqtitem) ? appqtitem : appcatitem);
						document.getElementById("apptheme").style.background = ((appthitem) ? appthitem : "#141414");

						p.innerHTML = appDescItem + '<br> <br><b>Description</b> <br>';
						if (applditem !== undefined) {
							p.innerHTML += applditem;
						} else {
							p.innerHTML += `Overview not available yet.`;
						}

						let sourceurl = appDetails.src
						if (sourceurl.startsWith("/Nova-Store")) {
							sourceurl = "Nova Store"
						}

						p.innerHTML += `<br><a class="srca">Hosted on: ` + sourceurl + `
					<br>Version: ` + appDetails.ver + `</a>`;

						p.innerHTML += `<br><button>#` + appcatitem + `</button>`

						document.getElementById('openbtn').style.display = "block"

						function getapnme(x) {
							return x.split('.')[0];
						}

						if (appald.some(app => getapnme(app.name) === appName)) {
							const appflor = appald.find(app => getapnme(app.name) === appName);
							document.getElementById('openbtn').innerText = "Open";
							document.getElementById('openbtn').onclick = async function () {
								window.parent.openfile(appflor.id)
							};
							installButton.textContent = 'Update';
							installButton.style.backgroundColor = "#2f2f2f";

							installButton.onclick = function () {
								installapp(appDetails, appName, this, "full");
							};
						} else {
							installButton.textContent = 'Install';
							installButton.style.backgroundColor = "var(--colors-special-good)";
							installButton.onclick = function () {
								installapp(appDetails, appName, this, "full");
							};

							const openButton = document.getElementById('openbtn');
							openButton.innerText = "Try";
							openButton.onclick = async function () {
								const item = appDetails.src; // Find the correct item
								let prefixurl = "";
								if (!item.startsWith("http")) {
									prefixurl = "https://adthoughtsglobal.github.io/";
								}
								const response = await fetch(prefixurl + item);
								const content = await response.text();
								window.parent.openwindow(appName, content); // Use appName instead of app.name
							};
						}
						document.getElementById("installer").showModal()
					} catch (error) {
						console.error(error);
					};
				});

		}

		// This function updates the button text based on the input content
		function updateButtonText() {
			const input = document.getElementById("fesinp").value.trim();
			const button = document.getElementById("actionButton");
			const currentHtml = button.innerHTML;

			let newHtml;

			if (isValidUrl(input)) {
				newHtml = ' <div class="material-symbols-rounded installbtnicn">download</div>';
			} else if (input.length > 0) {
				newHtml = ' <div class="material-symbols-rounded installbtnicn">search</div>';
			} else {
				newHtml = ' <div class="material-symbols-rounded installbtnicn">download</div>';
			}

			if (currentHtml !== newHtml) {
				button.innerHTML = newHtml;
			}
		}

		// This function checks if a string is a valid URL
		function isValidUrl(string) {
			try {
				new URL(string);
				return true;
			} catch {
				return false;
			}
		}

		// This function handles Enter key press to trigger the search/install action
		function handleEnterKey(event) {
			if (event.key === "Enter") {
				const input = document.getElementById("fesinp").value.trim();
				if (input.length > 0) {
					handleSearchOrInstall(document.getElementById("actionButton"));
				}
			}
		}

		async function handleSearchOrInstall(button) {
			const input = document.getElementById("fesinp").value.trim();
			if (isValidUrl(input)) {
				await installapp({ "src": input }, getAppNameFromUrl(input), button);
			} else {
				searchApps(input);
			}
		}

		function searchApps(query) {
			const resultsDiv = document.getElementById("searchresults");
			resultsDiv.style.display = 'block';
			resultsDiv.innerHTML = "<div class='loader'></div>";
			fetch("https://adthoughtsglobal.github.io/Nova-Store/db/database.json")
				.then(response => response.json())
				.then(data => {
					const results = data.data.filter(app => {
						const appName = app.name; // Directly access the 'name' property
						return appName.toLowerCase().includes(query.toLowerCase());
					});
					displaySearchResults(results);
				})
				.catch(error => {
					console.error("Error fetching app data:", error);
					resultsDiv.innerHTML = "Error loading search results.";
				});
		}

		function displaySearchResults(results) {
			const resultsDiv = document.getElementById("searchresults");
			resultsDiv.innerHTML = "";
			if (results.length === 0) {
				resultsDiv.innerHTML = "<p class='searchnores'>No results found.</p>";
				return;
			}
			results.forEach(app => {
				const appName = app.name; // Directly access the 'name' property
				const appDetails = app; // app is already the flattened details object

				const resultDiv = document.createElement("div");
				resultDiv.className = "resultapp";

				const dataSide = document.createElement("div");
				dataSide.className = "dataside";

				const title = document.createElement("b");
				title.className = "resultapptit";
				title.textContent = appName;

				const description = document.createElement("p");
				const descText = appDetails.desc || "No description available."; // Use 'desc' directly
				description.textContent = descText;

				dataSide.appendChild(title);
				dataSide.appendChild(description);

				const actionSide = document.createElement("div");
				actionSide.className = "actionside";

				const actionButton = document.createElement("button");
				actionButton.className = "chevronbtn";
				actionButton.innerHTML = `<i class="material-symbols-rounded">chevron_forward</i>`;

				resultDiv.setAttribute("onclick", `openappinstr('${appName}', ${JSON.stringify(appDetails)})`);

				actionSide.appendChild(actionButton);

				resultDiv.appendChild(dataSide);
				resultDiv.appendChild(actionSide);

				resultsDiv.appendChild(resultDiv);
			});
		}
	</script>
</body>

</html>