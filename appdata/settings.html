<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Settings App</title>
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	<script src="https://jscolor.com/release/2.5/jscolor-2.5.2/jscolor.js"></script>
	<meta name="nova-include" content="nova.css">
	<meta name="nova-icon"
		content="<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='40.8208' height='40.94891' viewBox='0,0,40.8208,40.94891'><g transform='translate(-219.51359,-159.63806)'><g data-paper-data='{&quot;isPaintingLayer&quot;:true}' fill-rule='nonzero' stroke-linecap='butt' stroke-linejoin='miter' stroke-miterlimit='10' stroke-dasharray='' stroke-dashoffset='0' style='mix-blend-mode: normal'><path d='M224.49728,191.97943c0,-6.51609 0,-20.12167 0,-23.80086c0,-1.79525 1.27743,-3.6813 3.28885,-3.6813c6.47459,0 20.55435,0 24.11403,0c1.56415,0 3.60258,1.44253 3.60258,3.6813c0,6.76316 0,20.4796 0,23.95744c0,1.53 -1.83996,3.36671 -3.60258,3.36671c-3.67444,0 -17.45008,0 -23.95744,0c-2.10186,0 -3.44544,-1.37709 -3.44544,-3.52329zM239.52997,189.92242c5.52285,0 10,-4.47715 10,-10c0,-5.52285 -4.47715,-10 -10,-10c-5.52285,0 -10,4.47715 -10,10c0,5.52285 4.47715,10 10,10z' fill='#7c888d' stroke='none' stroke-width='0'/><path d='M237.50865,199.43282c-4.60757,-4.60757 -14.22817,-14.22817 -16.82975,-16.82975c-1.26943,-1.26943 -1.69979,-3.50635 -0.2775,-4.92864c4.57823,-4.57823 14.53412,-14.53412 17.05119,-17.05119c1.10602,-1.10602 3.56743,-1.52738 5.15048,0.05567c4.78228,4.78228 14.48126,14.48126 16.94047,16.94047c1.08187,1.08187 1.07958,3.68167 -0.16678,4.92803c-2.59822,2.59822 -12.33907,12.33907 -16.94047,16.94047c-1.48624,1.48624 -3.41004,1.46254 -4.92764,-0.05506zM239.52997,189.92242c5.52285,0 10,-4.47715 10,-10c0,-5.52285 -4.47715,-10 -10,-10c-5.52285,0 -10,4.47715 -10,10c0,5.52285 4.47715,10 10,10z' fill='#7c888d' stroke='none' stroke-width='0'/><path d='M235.7745,180.11252c0,-2.2917 1.85779,-4.14949 4.14949,-4.14949c2.2917,0 4.14949,1.85779 4.14949,4.14949c0,2.2917 -1.85779,4.14949 -4.14949,4.14949c-2.2917,0 -4.14949,-1.85779 -4.14949,-4.14949z' fill='none' stroke='#7c888d' stroke-width='2.5'/></g></g></svg>">

	<style>
		* {
			box-sizing: border-box;
		}

		html {
			height: 100%;
			width: 100%;
			scroll-behavior: smooth;
		}

		body {
			height: 100%;
			margin: 0px;
			background: var(--colors-BG-normal);
		}

		.tab {
			flex-grow: 2;
			height: calc(100% - 10px);
			overflow-y: auto;
			max-width: 25vw;
			min-width: 100px;
			padding-bottom: 25vh;
		}

		.tab::after {
			height: 10vh;
			width: calc(100% - 10px);
			background: linear-gradient(0deg, var(--colors-BG-normal), transparent);
			content: "";
			display: block;
			position: absolute;
			bottom: 10px;
			z-index: 1;
		}

		.tab h3 {
			padding-left: 5px;
			margin: 5px 0px;
			font-weight: normal;
			font-size: var(--font-size-normal);
		}

		/* Style the buttons inside the tab */
		.tab button.active {
			background-color: var(--colors-BG-sub);
			color: var(--colors-text-sub);
			opacity: 1;
		}

		.tab button.active:hover {
			background-color: var(--colors-BG-section);
			opacity: 0.8;
		}

		.tab button {
			color: inherit;
			display: block;
			border: 2px solid transparent;
			background-color: transparent;
			padding: 4px 7px;
			width: calc(100% - 10px);
			margin: 2px;
			border-radius: var(--sizing-border-radius);
			outline: none;
			text-align: left;
			cursor: pointer;
			transition: 0.3s;
			font-size: inherit;
			overflow: hidden;
			white-space: nowrap;
			text-overflow: ellipsis;
			opacity: 0.7;
			font-family: inherit;
		}

		/* Change background color of buttons on hover */
		.tab button:hover {
			background-color: var(--colors-BG-sub);
			color: var(--colors-text-sub);
		}

		.tab button i {
			font-size: 10px;
			transform: translate(-6px, 0px) scale(1.5);
			margin-left: 10px;
		}

		.advancedsettab {
			animation: slideIn .3s ease-out !important;
		}

		@keyframes slideIn {
			0% {
				opacity: 0;
				padding-left: 1rem;
			}

			100% {
				opacity: 1;
				transform: translateX(0rem);
			}
		}

		/* Style the tab content */
		.tabcontent {
			padding: 0px 12px;
			width: 0;
			flex-grow: 3;
			min-width: 300px;
			padding-bottom: 30vh;
			background-color: inherit;
			animation: drop .2s ease-out;
			border-left: none;
			border-radius: var(--sizing-border-radius);
			height: calc(100% - 5px);
			animation: tab .2s;
			overflow-y: auto;
			margin-left: 5px;
		}

		@keyframes tab {
			0% {
				opacity: 0.1;
			}

			100% {
				opacity: 1;
			}
		}

		container {
			height: 100%;
			display: flex;
			padding: 5px;
			flex-direction: row;
			flex-wrap: nowrap;
		}

		td {
			padding-bottom: var(--sizing-normal);
			padding-top: var(--sizing-normal);
			vertical-align: top;
			padding-right: var(--sizing-huge);
			border-bottom: 1px solid #262626;
		}

		td b,
		ul li {
			color: var(--colors-text-sub);
			background: var(--colors-BG-sub);
			padding: 0.2rem 0.4rem;
			border-radius: var(--sizing-nano);
			cursor: pointer;
		}

		ul {
			margin: 0;
			padding: 0;
		}

		ul li {
			margin-bottom: var(--sizing-normal);
			width: fit-content;
			list-style: none;
		}

		supportb {
			border-radius: var(--sizing-normal);
			background: radial-gradient(circle at 0% 0%, var(--colors-BG-section), var(--colors-BG-sub));
			display: block;
			padding: var(--sizing-huge);
			margin-bottom: 0.5rem;
		}

		supportb b {
			font-size: var(--font-size-subheading);

		}

		supportb p {
			margin-top: 7px;
			margin-bottom: 0px;
		}

		supportb a {
			display: inline-block;
			border-radius: var(--sizing-border-radius);
			background: #ffffff;
			width: fit-content;
			padding: var(--sizing-normal) var(--sizing-huge);
			color: #1a4281;
			text-decoration: none;
			margin: 10px 0px;
			margin-bottom: 0;
			font-size: var(--font-size-normal);
			transition: .3s;
			cursor: pointer;
			display: inline-flex;
			align-items: center;
			gap: .3rem;
		}

		supportb a[okay] {
			background: transparent;
			color: white;
		}

		supportb a:hover {
			box-shadow: 0 0 10px pink;
		}

		supportb a[okay]:hover {
			background-color: #ffffff33;
			box-shadow: none;
		}

		supportb a i {
			font-size: 1rem !important;
			opacity: 0.7;
		}

		.supportbtns {
			display: flex;
			gap: 0.3rem;
			align-items: center;
		}

		#battery #batperdisp {
			font-size: 10vw;
			display: inline-block;
			width: fit-content;
			margin: 0;
			overflow: hidden;
		}

		small {
			display: block;
			padding: var(--sizing-normal);
			background: var(--colors-BG-section);
			color: var(--colors-text-section);
			border-radius: var(--sizing-border-radius);
		}

		segr small {
			background: var(--colors-BG-normal);
			color: var(--colors-text-normal);
		}

		small b {
			margin-top: 5px;
			display: block;
			font-size: var(--font-size-small);
		}

		.checkbox-wrapper-51 input[type="checkbox"] {
			visibility: hidden;
			display: none;
		}

		.checkbox-wrapper-51 .toggle {
			position: relative;
			display: block;
			width: 42px;
			height: 24px;
			cursor: pointer;
			-webkit-tap-highlight-color: transparent;
			transform: translate3d(0, 0, 0);
		}

		.checkbox-wrapper-51 .toggle:before {
			content: "";
			position: relative;
			top: 1px;
			left: 1px;
			width: 40px;
			height: 22px;
			display: block;
			background: #2a2a2a;
			border-radius: 12px;
			transition: background 0.2s ease;
		}

		.checkbox-wrapper-51 .toggle span {
			position: absolute;
			top: 0;
			left: 0;
			width: 24px;
			height: 24px;
			display: block;
			background: #6a6a6a;
			border-radius: 50%;
			transition: all 0.2s ease;
		}

		.checkbox-wrapper-51 .toggle span svg {
			margin: 7px;
			fill: none;
		}

		.checkbox-wrapper-51 .toggle span svg path {
			stroke: #4c4c4c;
			stroke-width: 2;
			stroke-linecap: round;
			stroke-linejoin: round;
			stroke-dasharray: 24;
			stroke-dashoffset: 0;
			transition: all 0.5s linear;
		}

		.checkbox-wrapper-51 input[type="checkbox"]:checked+.toggle:before {
			background: var(--colors-special-good);
			box-shadow: 0 2px var(--sizing-normal) #79e57947;
		}

		.checkbox-wrapper-51 input[type="checkbox"]:checked+.toggle span {
			transform: translateX(18px);
		}

		.checkbox-wrapper-51 input[type="checkbox"]:checked+.toggle span path {
			stroke: var(--colors-special-good);
			stroke-dasharray: 25;
			stroke-dashoffset: 25;
		}

		[settingn] {
			background: var(--colors-BG-section);
			color: var(--colors-text-section);
			padding: var(--sizing-normal);
			margin: 0;
		}

		[setting] {
			background: var(--colors-BG-section);
			color: var(--colors-text-section);
			padding: var(--sizing-normal);
			margin: 0;
			border-bottom: 1px solid var(--colors-BG-sub);
		}

		[setting][type="advsetnav"] {
			display: flex;
			flex-direction: row;
			align-items: center;
			gap: 0.5rem;
		}

		[setting][type="advsetnav"] .advseticon {
			padding: 0.5rem;
			background: #2f2f2f;
			border-radius: var(--sizing-border-radius);
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 1rem;
		}

		[setting][type="advsetnav"] .advsetnavbtnprt {
			flex: 1;
			display: flex;
			flex-direction: row;
			align-items: center;
			justify-content: space-between;
		}

		[setting][type="advsetnav"] .advsetnavbtnprt div {
			flex: 1;
		}

		[setting] b {
			font-weight: 500;
		}

		@keyframes drop {
			0% {
				transform: translateY(10px);
				opacity: 0;
			}

			100% {
				opacity: 1;
			}
		}

		[setting] .checkbox-wrapper-51 {
			float: right;
			transform: scale(0.7);
		}

		[setting] p {
			width: 80%;
			opacity: 0.5;
			margin: 0;
			font-size: var(--font-size-small);
		}

		#chargingIcon {
			transform: translateY(2px) scale(0.8);
			padding: 5px 1px 7px 1px;
			background: #054305;
			color: #4fb64f;
			margin-left: 5px;
			border-radius: var(--sizing-border-radius);
			display: inline-grid;
		}

		.nocss {
			width: var(--font-size-big);
			padding: 0;
			display: inline;
			outline: none;
			font-size: var(--font-size-small);
			color: white;
			background: none;
			margin: 0 3px;
			text-align: center;
			border: none;
		}


		.appli {
			background-color: var(--colors-BG-section);
			padding: 9px;
			margin-bottom: 0;
			border-radius: 0;
			border-bottom: 1px solid #4d4d4d;
		}

		#appdi {
			margin: 5px 0;
			border-radius: var(--sizing-border-radius);
			overflow: hidden;
		}

		.checkbox-wrapper-46 input[type="checkbox"] {
			display: none;
			visibility: hidden;
		}

		.checkbox-wrapper-46 .cbx {
			margin: auto;
			-webkit-user-select: none;
			user-select: none;
			cursor: pointer;
		}

		.checkbox-wrapper-46 .cbx span {
			display: inline-block;
			vertical-align: middle;
			transform: translate3d(0, 0, 0);
		}

		.checkbox-wrapper-46 .cbx span:first-child {
			position: relative;
			width: 18px;
			height: 18px;
			border-radius: var(--sizing-border-radius);
			transform: scale(1);
			vertical-align: middle;
			border: 1px solid #9098A9;
			transition: all 0.2s ease;
		}

		.checkbox-wrapper-46 .cbx span:first-child svg {
			position: absolute;
			top: 3px;
			left: 2px;
			fill: none;
			stroke: #FFFFFF;
			stroke-width: 2;
			stroke-linecap: round;
			stroke-linejoin: round;
			stroke-dasharray: 16px;
			stroke-dashoffset: 16px;
			transition: all 0.3s ease;
			transition-delay: 0.1s;
			transform: translate3d(0, 0, 0);
		}

		.checkbox-wrapper-46 .cbx span:first-child:before {
			content: "";
			width: 100%;
			height: 100%;
			background: #506EEC;
			display: block;
			transform: scale(0);
			opacity: 1;
			border-radius: 50%;
		}

		.checkbox-wrapper-46 .cbx span:last-child {
			padding-left: 8px;
		}

		.checkbox-wrapper-46 .cbx:hover span:first-child {
			border-color: #506EEC;
		}

		.checkbox-wrapper-46 .inp-cbx:checked+.cbx span:first-child {
			background: #506EEC;
			border-color: #506EEC;
			animation: wave-46 0.4s ease;
		}

		.checkbox-wrapper-46 .inp-cbx:checked+.cbx span:first-child svg {
			stroke-dashoffset: 0;
		}

		.checkbox-wrapper-46 .inp-cbx:checked+.cbx span:first-child:before {
			transform: scale(3.5);
			opacity: 0;
			transition: all 0.6s ease;
		}

		@keyframes wave-46 {
			50% {
				transform: scale(0.9);
			}
		}

		.progbarma {
			width: 100%;
			background-color: var(--colors-BG-sub);
			height: 20px;
			border-radius: var(--sizing-border-radius);
			overflow: hidden;
			margin: 10px 0px;
		}

		.appli:hover {
			background-color: var(--colors-BG-sub);
			color: var(--colors-text-sub);
		}

		.progbar {
			width: 1%;
			height: 30px;
			min-width: 2px;
			background-color: var(--colors-special-good);
		}

		button {
			color: var(--colors-text-high);
			border-radius: var(--sizing-border-radius);
			border: none;
			padding: 7px 15px;
			background: var(--colors-BG-highlighted);
			font-size: inherit;
			cursor: pointer;
			transition: .2s;
		}

		button:hover {
			transform: scale(0.95);
		}

		[danger] {
			background: var(--colors-BG-highlighted);
			opacity: 1;
			cursor: pointer;
		}

		.inpbox {
			background: var(--colors-BG-section);
			padding: var(--sizing-normal);
			color: var(--colors-text-section);
			outline: none;
			border-bottom: 1px solid var(--colors-BG-sub);
		}

		.inpbox select {
			background: var(--colors-BG-sub);
			color: var(--colors-text-sub);
			border: 1px solid var(--colors-BG-sub);
			border-radius: var(--sizing-border-radius);
			font-size: var(--font-size-normal);
			padding: 3px 1px 3px 9px !important;
			float: right;
			outline: none;
			transform: translate(3px, -2px);
		}

		@media only screen and (max-width: 600px) {
			.tab button {
				width: 35px;
			}

			.tab {
				min-width: 49px;
				flex-grow: 0;
			}
		}

		@media only screen and (max-width: 100px) {
			.tab button i {
				margin-bottom: 8px;
				display: block;
			}
		}

		h1 {
			font-weight: normal;
			font-size: var(--font-size-normal);
			margin-top: var(--sizing-huge);
			display: flex;
			flex-direction: row;
			gap: 0.5rem;
			align-items: center;
		}

		h3 {
			font-weight: normal;
			font-size: var(--font-size-normal);
			opacity: 0.7;
			margin-top: var(--sizing-huge);
			margin-bottom: var(--sizing-nano);

		}

		segr {
			margin-bottom: var(--sizing-normal);
			overflow: hidden;
			border-radius: var(--sizing-border-radius);
			display: block;
			border: 1px solid var(--colors-BG-sub);
			box-shadow: 0 3px 5px #0000007e;
		}

		span.advancedsetsbackbtn.material-symbols-rounded {
			display: inline-flex;
			font-size: 20px;
			background: var(--colors-BG-section);
			color: var(--colors-text-section);
			padding: 0.3rem;
			border-radius: 50%;
			align-items: center;
			justify-content: center;
			cursor: pointer;
		}

		.advancedsetsredbtn {
			float: right;
			margin: 0;
			padding: 0;
			background-color: transparent;
			color: var(--colors-text-section);
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.buttongrp {
			display: flex;
			flex-direction: row;
			justify-content: space-between;
			padding: var(--spacing-normal);
			gap: var(--spacing-gap);
			align-items: stretch;
			background-color: var(--colors-BG-section);
		}

		.btngrpelem {
			display: flex;
			flex-direction: column;
			align-items: center;
			flex: 1;
			padding: var(--sizing-normal);
			border-radius: var(--sizing-border-radius);
		}

		.btngrpelem:hover {
			background-color: var(--colors-BG-sub);
		}

		.btngrpelem b {

			font-size: 0.8rem;
			font-weight: normal;
		}

		.btngrpelem button {
			background-color: transparent;
			padding: 0;
		}

		.btngrpelem button i {
			font-size: 1rem;
		}

		.divider {
			width: 1px;
			background-color: rgb(117, 117, 117);
			opacity: 0.5;
		}
	</style>
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>

<body>
	<container>
		<div class="tab">

			<button class="tablinks" onclick="openCity(event, 'system')" id="defaultOpen"><i
					class="material-symbols-rounded">settings</i> System</button>
			<button class="tablinks" onclick="openCity(event, 'defaults'); defs5(); defs2(); defs3()"><i
					class="material-symbols-rounded">tune</i> Preferances</button>
			<button class="tablinks" onclick="openCity(event, 'exp'); defs();"><i
					class="material-symbols-rounded">monitor</i>
				Display</button>
			<button class="tablinks" onclick="openCity(event, 'password')"><i
					class="material-symbols-rounded">person</i>
				User</button>
			<button class="tablinks" onclick="openCity(event, 'network');"><i
					class="material-symbols-rounded">language</i>
				Network</button>
			<button class="tablinks" onclick="openCity(event, 'lclstgsc'); lclstgsc();"><i
					class="material-symbols-rounded">manage_search</i>
				Data Manager</button>
			<button class="tablinks" onclick="openCity(event, 'defaultappsforfiles'); defs2(); defs3()"><i
					class="material-symbols-rounded">open_in_browser</i> Defaults</button>
			<button class="tablinks" onclick="openCity(event, 'about')"><i class="material-symbols-rounded">info</i>
				About</button>

		</div>

		<div id="lclstgsc" class="tabcontent">
			<style>
				.datamangernav {
					display: flex;
					justify-content: space-between;
					align-items: center;
					padding: 0.1rem var(--sizing-normal);
					background: var(--colors-BG-section);
					color: var(--colors-text-section);
					border-radius: var(--sizing-normal);
				}

				.datamangernav i {

					font-size: var(--font-size-normal) !important;
					transform: translateY(3px);
				}

				.lclstr {
					border-bottom: 2px solid var(--colors-BG-sub);
					color: var(--colors-text-sub);
					padding: 0.2rem var(--sizing-normal);
					margin-top: 0.2rem;
					display: flex;
					flex-direction: row;
					flex-wrap: nowrap;
				}

				.lclstr:hover {
					background: #1f1f1f69;
					transition: 0.3s;
				}

				.lclstr span {
					width: 0;
					word-break: break-all;
				}

				.lclstr .name {
					flex: 1;
					margin-right: 0.2rem;
				}

				.lclstr .value {
					flex: 3;
				}

				.lclstr .material-symbols-rounded {
					width: 20px;
					font-size: var(--sizing-huge);
					display: grid;
					justify-items: center;
					align-items: center;
					opacity: 0.5;
				}
			</style>
			<h1>Data Manager</h1>
			<div class="datamangernav">
				<span>LocalStorage</span>
				<a onclick="lclstgsc()"><i class="material-symbols-rounded">restart_alt</i></a>
			</div>
			<div id="datalist">

			</div>
			<script>
				async function lclstgsc() {
					document.getElementById("datalist").innerHTML = "";
					let items = {};
					for (let i = 0; i < localStorage.length; i++) {
						let key = localStorage.key(i);
						if (key == "magicString") {
							continue;
						}
						items[key] = localStorage.getItem(key);
						const elem = document.createElement("div");
						elem.classList = "lclstr";
						const elemname = document.createElement("span");
						elemname.classList = "name";
						elemname.innerText = key;
						elem.appendChild(elemname);
						const elemval = document.createElement("span");
						elemval.classList = "value";
						elemval.innerText = items[key];
						elemval.addEventListener('click', async function () {
							let x = await window.parent.ask("Set value for '" + key + "':", items[key]);
							localStorage.setItem(key, x)
						});
						elem.appendChild(elemval);
						const delbtn = document.createElement("span");
						delbtn.classList = "material-symbols-rounded";
						delbtn.innerHTML = "delete_forever";
						delbtn.addEventListener('click', async function () {
							localStorage.removeItem(key);
							lclstgsc();
						});
						elem.appendChild(delbtn);
						document.getElementById("datalist").appendChild(elem)
					}
				}
			</script>
		</div>

		<div id="perform" class="tabcontent advancedsettab">
			<h1><span class="material-symbols-rounded advancedsetsbackbtn" onclick="openCity(event, 'system');">
					arrow_back
				</span> Performance</h1>
			<style>
				.graphcanvas {
					width: 100%;
					max-height: 100px;
					background: #141414;
					border-radius: var(--sizing-normal);
				}

				.bigtext {
					font-size: 10vw;
					display: inline-block;
					width: fit-content;
					margin: 0;
				}

				#fpsprof::after {
					content: 'FPS';
					padding: 2px 8px;
					font-size: 13px;
					border-radius: 5px;
					background-color: var(--colors-BG-section);
					color: var(--colors-text-section);
					display: inline-block;
					border: 1px solid var(--colors-BG-sub);
					margin-left: 10px;
					transform: translate(5px, -10px);
				}
			</style>
			<h1 id="fpsprof" class="bigtext">0</h1>
			<br>
			<canvas class="graphcanvas" id="fpsCanvas" width="400" height="200"></canvas>

			<h1>Memory</h1>
			<h1 id="ramprof" class="bigtext">0</h1>
			<br>
			<canvas class="graphcanvas" id="HeapCanvas" width="400" height="200"></canvas>

			<script>
				var running, currentpage;

				function updateFPS() {
					updateRAMUsage();
					var canvas = document.getElementById('fpsCanvas');
					var ctx = canvas.getContext('2d');
					var startTime = Date.now();
					var frameCount = 0;
					var fpsValues = [];

					function calculateFPS() {
						var elapsedTime = Date.now() - startTime;
						var fps = Math.round((frameCount * 1000) / elapsedTime);
						fpsValues.push(fps);

						// Clear canvas
						ctx.clearRect(0, 0, canvas.width, canvas.height);

						// Get the last 30 frames, or all frames if there are less than 30
						var numFrames = 30;
						var fpsSubset = fpsValues.slice(-numFrames);

						var stepX = canvas.width / fpsSubset.length;
						var maxY = Math.max(...fpsSubset);
						var stepY = canvas.height / (maxY + 10); // Add 10 for padding

						// Start drawing the FPS graph
						ctx.beginPath();
						var initialX = 0;
						var initialY = canvas.height - fpsSubset[0] * stepY;
						ctx.moveTo(initialX, initialY);

						fpsSubset.push(fpsSubset[fpsSubset.length - 1]);

						fpsSubset.forEach(function (fps, index) {
							var x = index * stepX;
							var y = canvas.height - fps * stepY;
							ctx.lineTo(x, y);
						});

						// Connect the line graph to the bottom of the canvas
						ctx.lineTo(canvas.width, canvas.height);
						ctx.lineTo(0, canvas.height);

						// Fill the area below the line graph with dark blue color
						ctx.fillStyle = '#263238';
						ctx.fill();

						// Draw the line graph
						ctx.strokeStyle = '#7986CB';
						ctx.lineWidth = 2;
						ctx.stroke();
						document.getElementById('fpsprof').innerText = fps;

						frameCount = 0;
						startTime = Date.now();
					}

					function render() {
						frameCount++;
						requestAnimationFrame(render);
					}

					render();

					let intervalId = setInterval(function () {
						if (currentpage === 'perform') {
							calculateFPS();
						} else {
							clearInterval(intervalId);
						}
					}, 500);
				}

				function updateRAMUsage() {
					var canvas = document.getElementById('HeapCanvas');
					var ctx = canvas.getContext('2d');
					var heapValues = [];

					function getMemoryUsage() {
						if (performance.memory) {
							var totalMemory = performance.memory.totalJSHeapSize / (1024 * 1024);
							var usedMemory = performance.memory.usedJSHeapSize / (1024 * 1024);
							var memoryUsage = (usedMemory / totalMemory) * 100;
							heapValues.push(memoryUsage);
						}

						ctx.clearRect(0, 0, canvas.width, canvas.height);

						var numFrames = 30;
						var heapSubset = heapValues.slice(-numFrames);

						var stepX = canvas.width / heapSubset.length;
						var maxY = Math.max(...heapSubset);
						var stepY = canvas.height / (maxY + 10);

						ctx.beginPath();
						var initialX = 0;
						var initialY = canvas.height - heapSubset[0] * stepY;
						ctx.moveTo(initialX, initialY);

						heapSubset.push(heapSubset[heapSubset.length - 1]);

						heapSubset.forEach(function (usage, index) {
							var x = index * stepX;
							var y = canvas.height - usage * stepY;
							ctx.lineTo(x, y);
						});

						ctx.lineTo(canvas.width, canvas.height);
						ctx.lineTo(0, canvas.height);

						ctx.fillStyle = '#263828';
						ctx.fill();

						ctx.strokeStyle = '#4CAF50';
						ctx.lineWidth = 2;
						ctx.stroke();
						document.getElementById('ramprof').innerText = `${heapSubset[heapSubset.length - 1].toFixed(0)}%`;

					}

					let ramIntervalId = setInterval(function () {
						if (currentpage === 'perform') {
							getMemoryUsage();
						} else {
							clearInterval(ramIntervalId);
						}
					}, 500);
				}
			</script>
		</div>

		<div id="system" class="tabcontent">
			<h1>System</h1>

			<segr>
				<div setting type="advsetnav" onclick="openCity(event, 'storage');">
					<i class="material-symbols-rounded advseticon">storage</i>
					<div class="advsetnavbtnprt">
						<div>
							<b>Storage</b>
							<p>Stats, actions and more...</p>
						</div>
						<button class="advancedsetsredbtn"><span class="material-symbols-rounded">
								chevron_right
							</span></button>
					</div>
				</div>
				<div setting type="advsetnav" onclick="openCity(event, 'battery');">
					<i class="material-symbols-rounded advseticon">battery_full</i>
					<div class="advsetnavbtnprt">
						<div>
							<b>Battery</b>
							<p>Percentage, remarks and status</p>
						</div>
						<button class="advancedsetsredbtn"><span class="material-symbols-rounded">
								chevron_right
							</span></button>
					</div>
				</div>
				<div setting type="advsetnav" onclick="openCity(event, 'devices');">
					<i class="material-symbols-rounded advseticon">devices</i>
					<div class="advsetnavbtnprt">
						<div>
							<b>Devices</b>
							<p>Lists all connected devices</p>
						</div>
						<button class="advancedsetsredbtn"><span class="material-symbols-rounded">
								chevron_right
							</span></button>
					</div>
				</div>
			</segr>
			<h1>Processes</h1>

			<segr>
				<div setting type="advsetnav" onclick="openCity(event, 'activity'); taskmg()">
					<i class="material-symbols-rounded advseticon">poll</i>
					<div class="advsetnavbtnprt">
						<div>
							<b>Activity</b>
							<p>List and force close running processes</p>
						</div>
						<button class="advancedsetsredbtn"><span class="material-symbols-rounded">
								chevron_right
							</span></button>
					</div>
				</div>
				<div setting type="advsetnav" onclick="openCity(event, 'perform'); updateFPS()">
					<i class="material-symbols-rounded advseticon">speed</i>
					<div class="advsetnavbtnprt">
						<div>
							<b>Performance</b>
							<p>FPS and memory usage graphs</p>
						</div>
						<button class="advancedsetsredbtn"><span class="material-symbols-rounded">
								chevron_right
							</span></button>
					</div>
				</div>
			</segr>
		</div>
		<div id="storage" class="tabcontent advancedsettab">
			<h1><span class="material-symbols-rounded advancedsetsbackbtn" onclick="openCity(event, 'system');">
					arrow_back
				</span> Storage</h1>
			<segr>
				<div settingn>
					<b>IndexedDB</b><br>
					<div class="progbarma" id="myProgress2">
						<div id="myBar2" class="progbar"></div>
					</div>
					<small id="storemark2">Your system has crashed. Please Update.</small>
				</div>
				<div settingn id="storagesuggs">
					<p style="margin-top: 0px;">Ran out of storage?<br>Get more storage by removing some files</p>
					<button>Open Files</button>
				</div>
			</segr>
			<segr>

				<script>
					async function erdbs() {
						if (!confirm("Erase Device? \nThis will remove all data, including every user's files, folders, apps, permissions, cache and everything.\n\nWould you like to Clear your device?")) {
							return;
						}
						window.parent.erdbsfull();
					}
					async function erdbsur() {
						if (!confirm("Remove User? \nThis will remove your data, including your files, folders, apps, permissions, cache and everything.\n\nWould you like to Clear your account?")) {
							return;
						}
						window.parent.removeUser();
					}

				</script>

				<div class="buttongrp">
					<div class="btngrpelem">
						<button onclick="erdbsur()">
							<span class="material-symbols-rounded">
								person_remove
							</span>
						</button>
						<b>Remove user</b>
					</div>
					<div class="divider"></div>
					<div class="btngrpelem">
						<button onclick="erdbs()">
							<span class="material-symbols-rounded">
								delete_sweep
							</span>
						</button>
						<b>Erase device</b>
					</div>
					<div class="divider"></div>
					<div class="btngrpelem">
						<button onclick="window.parent.ercache()">

							<span class="material-symbols-rounded">
								delete_history
							</span>
						</button>
						<b>Reset cache</b>
					</div>
				</div>

			</segr>
			<segr>
				<script>
					async function updefapps() {
						try {
							document.getElementById("updefapplog").innerHTML = "Installing...";
							await window.parent.installdefaultapps();
							document.getElementById("updefapplog").innerHTML = "All Default apps updated. <b>Re-open Settings to reflect changes.</b>";
						} catch (error) {
							console.error("Error updating default apps:", error);
						}
					}

				</script>
				<div setting>
					<b>Update Default Apps</b>
					<button style="margin-top: 5px;float: right;" onclick="updefapps()">Update</button>
					<p>Update or reinstall deleted or corrupted versions of default apps.</p>

					<small id="updefapplog" style="margin-top: 5px;">Updating default apps frequently can assure newer
						features and bug fixes.</small>
				</div>
			</segr>
		</div>

		<div id="defaults" class="tabcontent">
			<h1>Preferances</h1>
			<segr>
				<div setting>
					<div class="checkbox-wrapper-51">
						<input type="checkbox" id="cbx-65" role="submit">
						<label for="cbx-65" class="toggle">
							<span>
								<svg width="10px" height="10px" viewBox="0 0 10 10">
									<path
										d="M5,1 L5,1 C2.790861,1 1,2.790861 1,5 L1,5 C1,7.209139 2.790861,9 5,9 L5,9 C7.209139,9 9,7.209139 9,5 L9,5 C9,2.790861 7.209139,1 5,1 L5,9 L5,1 Z">
									</path>
								</svg>
							</span>
						</label>
					</div>
					<b>Focus Mode</b>
					<p>Blur the background image slowly while you use apps.
					</p>
				</div>
				<div setting>
					<div class="checkbox-wrapper-51">
						<input type="checkbox" id="cbx-66" role="submit">
						<label for="cbx-66" class="toggle">
							<span>
								<svg width="10px" height="10px" viewBox="0 0 10 10">
									<path
										d="M5,1 L5,1 C2.790861,1 1,2.790861 1,5 L1,5 C1,7.209139 2.790861,9 5,9 L5,9 C7.209139,9 9,7.209139 9,5 L9,5 C9,2.790861 7.209139,1 5,1 L5,9 L5,1 Z">
									</path>
								</svg>
							</span>
						</label>
					</div>
					<b>Window Snapping</b>
					<p>Drag a window to the sides of your screen to snap it in place.
					</p>
				</div>
				<div setting>
					<div class="checkbox-wrapper-51">
						<input type="checkbox" id="cbx-70" role="submit">
						<label for="cbx-70" class="toggle">
							<span>
								<svg width="10px" height="10px" viewBox="0 0 10 10">
									<path
										d="M5,1 L5,1 C2.790861,1 1,2.790861 1,5 L1,5 C1,7.209139 2.790861,9 5,9 L5,9 C7.209139,9 9,7.209139 9,5 L9,5 C9,2.790861 7.209139,1 5,1 L5,9 L5,1 Z">
									</path>
								</svg>
							</span>
						</label>
					</div>
					<b>Use NovaOS offline</b>
					<p>If enabled, Nova will try to cache the os and save it offline.
					</p>
				</div>

				<div setting>
					<div class="checkbox-wrapper-51">
						<input type="checkbox" id="cbx-71" role="submit">
						<label for="cbx-71" class="toggle">
							<span>
								<svg width="10px" height="10px" viewBox="0 0 10 10">
									<path
										d="M5,1 L5,1 C2.790861,1 1,2.790861 1,5 L1,5 C1,7.209139 2.790861,9 5,9 L5,9 C7.209139,9 9,7.209139 9,5 L9,5 C9,2.790861 7.209139,1 5,1 L5,9 L5,1 Z">
									</path>
								</svg>
							</span>
						</label>
					</div>
					<b>Enable Nova Copilot</b>
					<p>AI copilot in your Nova Nav.
					</p>
				</div>
				<div setting>
					<div class="checkbox-wrapper-51">
						<input type="checkbox" id="cbx-69" role="submit">
						<label for="cbx-69" class="toggle">
							<span>
								<svg width="10px" height="10px" viewBox="0 0 10 10">
									<path
										d="M5,1 L5,1 C2.790861,1 1,2.790861 1,5 L1,5 C1,7.209139 2.790861,9 5,9 L5,9 C7.209139,9 9,7.209139 9,5 L9,5 C9,2.790861 7.209139,1 5,1 L5,9 L5,1 Z">
									</path>
								</svg>
							</span>
						</label>
					</div>
					<b>SmartSearch</b>
					<p>Search through your files based on similarity algorithms.
					</p>
				</div>
				<div class="inpbox">
					<span>Save Camera images as </span>
					<select id="scapimas">
						<option>PNG</option>
						<option>JPEG</option>
						<option>WEBP</option>
					</select>
				</div>
				<small>Retain quality while compression using PNG.</small>
				<script>
					async function defs() {

						document.getElementById('copy-theme-btn').addEventListener('click', copyCurrentTheme);
						document.getElementById('paste-theme-btn').addEventListener('click', pasteThemeFromClipboard);

						let sizes2323 = {
							"-1": 0.8,
							0: 1,
							1: 1.1,
							2: 1.3
						};

						let storedUISizing = await window.parent.getSetting("UISizing");

						let matchingKey = Object.keys(sizes2323).find(key => sizes2323[key] === storedUISizing);

						if (matchingKey !== undefined) {
							document.getElementById("UISIZErangeslid").value = matchingKey;
						} else {
							console.log("No UISizing set ", storedUISizing);
						}

						document.getElementById("UISIZErangeslid").addEventListener("input", async function () {
							let newValue = sizes2323[document.getElementById("UISIZErangeslid").value];
							await window.parent.setSetting("UISizing", newValue);
							window.parent.checkdmode();
						});


						let storedwall = await window.parent.getSetting("wall");

						if (storedwall) {
							document.getElementById("wallpaperurl").value = storedwall;
						} else {
							console.log("No wallpaper set ", storedwall);
						}
					}

					async function defs5() {
						console.log("defs5 loaded");

						// focus mode
						document.getElementById("cbx-65").addEventListener("change", async function () {
							let newValue2 = document.getElementById("cbx-65").checked;
							await window.parent.setSetting("focusMode", newValue2);
							window.parent.dewallblur()
						});

						try {
							if (await window.parent.getSetting("focusMode")) {
								document.getElementById("cbx-65").checked = true;
							}
						} catch (error) {
							console.error(error)
						}

						// smartsearch
						document.getElementById("cbx-69").addEventListener("change", async function () {
							let newValue2 = document.getElementById("cbx-69").checked;
							await window.parent.setSetting("smartsearch", newValue2)
							window.parent.qsetsRefresh()
						});

						try {
							if (await window.parent.getSetting("smartsearch")) {
								document.getElementById("cbx-69").checked = true;
							}
						} catch (error) {
							console.error(error)
						}

						// offline nova
						document.getElementById("cbx-70").addEventListener("change", function () {
							let newValue2 = document.getElementById("cbx-70").checked;
							if (newValue2) {
								window.parent.useNovaOffline();
							} else {
								window.parent.removeSWs()
							}
							window.parent.setSetting("novaOffline", newValue2)
						});

						try {
							if (await window.parent.getSetting("novaOffline")) {
								document.getElementById("cbx-70").checked = true;
							}
						} catch (error) {
							console.error(error)
						}


						// nova copilot
						document.getElementById("cbx-71").addEventListener("change", function () {
							let newValue2 = document.getElementById("cbx-71").checked;
							window.parent.setSetting("copilot", newValue2)
						});

						try {
							if (await window.parent.getSetting("copilot")) {
								document.getElementById("cbx-71").checked = true;
							}
						} catch (error) {
							console.error(error)
						}

						// window snapping
						document.getElementById("cbx-66").addEventListener("change", function () {
							let newValue2 = document.getElementById("cbx-66").checked;
							window.parent.setSetting("wsnapping", newValue2)
						});

						try {
							if (await window.parent.getSetting("wsnapping")) {
								document.getElementById("cbx-66").checked = true;
							}
						} catch (error) {
							console.error(error)
						}

						// save cam images as
						let selinp;
						selinp = document.getElementById("scapimas");
						try {
							if (await window.parent.getSetting("CamImgFormat")) {
								selinp.value = await window.parent.getSetting("CamImgFormat");
							}
						} catch (error) {
							console.error(error)
						}
						document.getElementById("scapimas").addEventListener("change", function () {
							let newValue = document.getElementById("scapimas").value;
							window.parent.setSetting("CamImgFormat", newValue)
						});
					}
				</script>
				<div class="inpbox">
					<span>Default files app view mode </span>
					<select id="defflvm">
						<option>Grid</option>
						<option>List</option>
					</select>
				</div>
				<script>
					async function defs2() {
						let selinp;
						selinp = document.getElementById("defflvm");
						try {
							if (await window.parent.getSetting("defflvm")) {
								selinp.value = defflvm;
							}
						} catch (error) {
							console.error(error)
						}
						document.getElementById("defflvm").addEventListener("change", function () {
							let newValue = document.getElementById("defflvm").value;
							window.parent.setSetting("defFileLayout", newValue)
						});
					}
				</script>
				<div class="inpbox">
					<span>Time Format </span>
					<select id="timefrmt">
						<option>12 Hour</option>
						<option>24 Hour</option>
					</select>
				</div>
				<div class="inpbox">
					<span>Default Search Engine </span>
					<select id="defSearchEngine">
						<option>NWP</option>
						<option>Bing</option>
					</select>
				</div>
				<script>
					async function defs3() {
						let selinp;
						selinp = document.getElementById("timefrmt");
						if (await window.parent.getSetting("timefrmt")) {
							selinp.value = await window.parent.getSetting("timefrmt");
						}
						document.getElementById("timefrmt").addEventListener("change", function () {
							let newValue = document.getElementById("timefrmt").value;
							window.parent.setSetting("timefrmt", newValue);
							window.parent.say("Reload NovaOS for the changes to take effect.");
						});

						let selinp2 = document.getElementById("defSearchEngine");
						if (await window.parent.getSetting("defSearchEngine")) {
							selinp2.value = await window.parent.getSetting("defSearchEngine");
						}
						document.getElementById("defSearchEngine").addEventListener("change", function () {
							let newValue = document.getElementById("defSearchEngine").value;
							window.parent.setSetting("defSearchEngine", newValue)
						});
					}
				</script>
			</segr>
			<segr>
				<div setting>
					<b>Reset Settings</b>
					<button style="margin-top: 5px;float: right;" onclick="restsettings();" danger>Reset</button>
					<p>Reset to default settings.</p>
					<script>
						async function restsettings() {
							try {
								await window.parent.resetSettings();
							} catch (error) {
								console.error("Error updating default apps:", error);
							}
						}

					</script>
				</div>
			</segr>
		</div>

		<div id="defaultappsforfiles" class="tabcontent">
			<h1>Defaults</h1>
			<style>
				#appfileassos {
					svg {
						height: 1.5rem;
						max-width: 1.5rem;
						background: #57575733;
						padding: 3px;
						min-width: var(--sizing-normal);
						border-radius: var(--sizing-nano);
					}

					.table {
						display: flex;
						flex-direction: column;
						width: 100%;
						border-radius: var(--sizing-normal);
						overflow: hidden;
					}

					.header-row,
					.row {
						display: flex;
						border-bottom: 1px solid #333333;
						padding: 8px 0;
					}

					.header-row {
						background-color: var(--colors-BG-section);
						color: var(--colors-text-section);
						font-weight: normal;
						opacity: 0.7;
						font-size: var(--font-size-small);
					}

					.cell {
						padding: 8px;
						display: flex;
						align-items: center;
						justify-content: flex-start;
					}

					.file-type-cell {
						font-size: var(--font-size-normal);
					}

					.file-type-header,
					.file-type-cell {
						flex: 1;
						border-right: 1px solid #353535;
						padding-left: 16px;
					}

					.default-app-header,
					.default-app-cell {
						flex: 2;
						padding-left: 16px;
						display: flex;
						flex-direction: column;
						align-items: flex-start;
					}

					.row:last-child {
						border-bottom: none;
					}

					.subapps {

						.material-symbols-rounded {
							color: #7b7b7b;
							font-size: var(--sizing-huge) !important;
							transform: translateY(-2px);
							margin-right: var(--sizing-normal);
						}
					}


				}

				.themestoreopner {
					height: 2rem;
					margin-top: 5px;
				}
			</style>
			<button onclick="rldfltyptable()" style="margin-bottom: var(--sizing-normal);">Reload Table</button>
			<div id="appfileassos">

			</div>
			<script>
				var currentreqID, replaceableapp, clickedRowId;

				async function rldfltyptable() {
					const fileAssociations = window.parent.fileTypeAssociations;

					async function createTable(fileAssociations) {
						const table = document.createElement('div');
						table.className = 'table';

						const headerRow = document.createElement('div');
						headerRow.className = 'header-row';

						const fileTypeHeader = document.createElement('div');
						fileTypeHeader.className = 'header-cell file-type-header';
						fileTypeHeader.textContent = 'File Types';

						const defaultAppHeader = document.createElement('div');
						defaultAppHeader.className = 'header-cell default-app-header';
						defaultAppHeader.textContent = 'Apps';

						headerRow.appendChild(fileTypeHeader);
						headerRow.appendChild(defaultAppHeader);
						table.appendChild(headerRow);

						for (const [extension, apps] of Object.entries(fileAssociations)) {
							const row = document.createElement('div');
							row.className = 'row';
							row.id = `row-${extension}`;

							const fileTypeCell = document.createElement('div');
							fileTypeCell.className = 'cell file-type-cell';
							fileTypeCell.textContent = extension;

							const defaultAppCell = document.createElement('div');
							defaultAppCell.className = 'cell default-app-cell';
							defaultAppCell.innerHTML = await window.parent.getAppIcon(0, apps[0], true);
							defaultAppCell.onclick = () => {
								replaceableapp = apps[0];
								currentreqID = window.parent.genUID();
								clickedRowId = row.id; // Store the clicked row's ID
								let appIdToOpen = window.parent.fileTypeAssociations['file'][0] || null;
								window.parent.openlaunchprotocol(appIdToOpen, { "opener": "app", "dir": "Apps/" }, currentreqID, myWindow.windowID);
							};

							row.appendChild(fileTypeCell);
							row.appendChild(defaultAppCell);
							table.appendChild(row);
						}

						if (!Object.entries(fileAssociations).length) {
							table.innerHTML = '';
							const idkspan = document.createElement("span");
							idkspan.style.opacity = "0.5"
							idkspan.innerText = window.parent.getRandomNothingQuote();
							table.appendChild(idkspan);
						}

						return table;
					}
					const table = await createTable(fileAssociations);
					document.getElementById('appfileassos').innerHTML = '';
					document.getElementById('appfileassos').appendChild(table);
				}

				rldfltyptable();

				window.addEventListener('message', async (event) => {
					const fileAssociations = window.parent.fileTypeAssociations;
					if (event.data.action === 'loadlocalfile') {
						if (event.data.id === myWindow.windowID) {
							let targetAppId = replaceableapp;
							let newAppId = event.data.returned;

							for (let key in fileAssociations) {
								if (fileAssociations.hasOwnProperty(key)) {
									fileAssociations[key] = fileAssociations[key].map(appId => appId === targetAppId ? newAppId : appId);
								}
							}
							await window.parent.setSetting('fileTypeAssociations', fileAssociations);

							// Update the icon in only the clicked row
							const row = document.getElementById(clickedRowId);
							if (row) {
								const defaultAppCell = row.querySelector('.default-app-cell');
								defaultAppCell.innerHTML = await window.parent.getAppIcon(0, newAppId, true);
							}
						}
					}
				});
			</script>
		</div>

		<div id="password" class="tabcontent">
			<h1>Password</h1>
			<segr>
				<style>
					[setting].spread {
						display: flex;
						flex-direction: row;
						align-items: center;
						justify-content: space-between;
					}

					[setting].formlike {
						display: flex;
						flex-direction: column;
						justify-content: space-between;
						gap: 0.3rem;
					}
				</style>
				<div setting id="changpassthingy" class="spread">
					<b id="passstat"></b>
					<button onclick="chstpass()">Continue</button>
				</div>
				<div setting class="spread">
					<b id="userstatsi">Signed in as Admin</b>
					<button onclick="window.parent.logoutofnova()">Sign Out</button>
				</div>
			</segr>
			<script>
				document.getElementById("userstatsi").innerHTML = 'Signed in as ' + window.parent.CurrentUsername;
				if (window.parent.password == 'nova') {
					document.getElementById("passstat").innerHTML = "Set a password for your device:";
				} else {
					document.getElementById("passstat").innerHTML = "Change your password";
				}
				async function chstpass() {
					var setpass = '';
					if (window.parent.password == 'nova') {
						setpass = await window.parent.ask("Set a password: ", "")
					} else {
						setpass = await window.parent.ask("Choose an another password: ", window.parent.password);
						if (setpass == window.parent.password) {
							window.parent.say("That is your current password. Choose a different one.", "failed")
							return;
						}
					}
					if (await window.parent.justConfirm("Are you sure?", "All your data will be lost if you forget this password. Re-encrypt all your files with this one?")) {
						await window.parent.changePassword(window.parent.password, setpass);
						await window.parent.say("Click OK when you are ready to restart your OS.")
						window.parent.location.reload()
					} else {
						return;
					}
				}
			</script>

		</div>

		<div id="battery" class="tabcontent advancedsettab">
			<h1><span class="material-symbols-rounded advancedsetsbackbtn" onclick="openCity(event, 'system');">
					arrow_back
				</span> Battery</h1>
			<h1 id="batperdisp">Here's lies battery %</h1>
			<p id="batperrem"></p>
			<small>Remarks may be innacurate or misleading.</small>
			<script>
				var batchar;
				navigator.getBattery().then(function (battery) {
					updateBatteryInfo(battery);

					battery.addEventListener('chargingchange', function () {
						updateBatteryInfo(battery);
					});
				});

				function updateBatteryInfo(battery) {
					batchar = battery.charging;
					console.log(batchar)
					var batteryPercentage = (battery.level * 100).toFixed(0);
					document.getElementById("batperdisp").innerHTML = batteryPercentage + "%";

					var batteryRemark = getBatteryRemark(batteryPercentage);
					document.getElementById("batperrem").innerHTML = batteryRemark;

					var chargingIcon = document.getElementById("chargingIcon");
					if (batchar) {
						document.getElementById("batperdisp").innerHTML += '<g id="chargingIcon"><i class="material-symbols-rounded" >battery_charging_full</i></g>';
					} else {
					}
				}

				function getBatteryRemark(percentage) {
					if (percentage == 0) {
						if (batchar) {
							return "Your device does not have a working battery."
						} else {
							return "Your battery feed is malfunctioning.";
						}
					} else if (percentage < 20) {
						if (batchar) {
							return "Your battery is still low, keep charging."
						} else {
							return "Your battery is running low. Please charge soon.";
						}
					} else if (percentage < 50) {
						if (batchar) {
							return "You have some battery left, But let it keep charging."
						} else {
							return "You have some battery left. Consider charging.";
						}
					} else if (percentage < 90) {
						if (batchar) {
							return "Your battery is in good condition. You may unplug your charger if needed."
						} else {
							return "Your battery is in good condition. No need to worry.";
						}
					} else if (batchar) {
						return "Overcharging your device is not reccomended. You may unplug the charger now."
					} else if (batchar && percentage == 100) {
						return "Your device works without a battery. Remember to constantly save your files, you may lose progress otherwise."
					} else {
						return "Very high battery, keep it up.";
					}
				}</script>
		</div>
		<div id="about" class="tabcontent">
			<h2 style="margin-bottom: 3px;">Nova OS <span style="font-weight: normal;">Solaris</span></h2>
			<p style="margin-top: 3px;">Version 2.05</p>
			<p>You are Using Nova OS Web. <br>Thank you for being in the Nova Ecosystem.</p>
			<supportb>
				<b>Support NovaOS?</b>
				<p>Support us making NovaOS into a better and more powerful place for you. Starting from 1$.
				</p>
				<style>
					.doablestep {
						display: flex;
						justify-content: space-between;
						background: var(--colors-BG-normal);
						border-radius: var(--sizing-border-radius);
						padding: .3rem;
						align-items: center;
					}

					.doablestep button {
						padding: .3rem;
						background-color: var(--colors-BG-section);
						color: var(--colors-text-section);
						display: flex;
						align-items: center;
						justify-content: center;
						width: fit-content;
						min-width: 0;
					}

					.doablestep b {
						font-size: var(--font-size-normal);
						font-weight: normal;
						margin-left: 0.5rem;
					}

					#supportexpandable {
						display: none;
						flex-direction: column;
						gap: .3rem;
						margin-top: 0.5rem;
						animation: tab .3s;
					}
				</style>
				<div id="supportexpandable">
					<div class="doablestep">
						<b>View Memberships</b>
						<button onclick="window.open('https://www.patreon.com/adthoughtsglobal/membership')"><i
								class="material-symbols-rounded">chevron_right</i></button>
					</div>
					<div class="doablestep">
						<b>Star the repo</b>
						<button onclick="window.open('https://github.com/adthoughtsglobal/Nova-OS')"><i
								class="material-symbols-rounded">chevron_right</i></button>
					</div>
				</div>
				<div class="supportbtns">
					<a id="membershipsbtn"
						onclick="window.open('https://www.patreon.com/adthoughtsglobal/membership')">Memberships</a>
					<a okay onclick="supportexpand();" id="supportexpandbtn"><i
							class="material-symbols-rounded">expand_circle_down</i> More ways</a>
				</div>

				<script>
					function supportexpand() {
						if (document.getElementById("membershipsbtn").style.display == "none") {
							document.getElementById("membershipsbtn").style.display = "block";
							document.getElementById("supportexpandable").style.display = "none"
							document.getElementById("supportexpandbtn").innerHTML = `<i
							class="material-symbols-rounded">expand_circle_down</i> More ways`;

						} else {
							document.getElementById("membershipsbtn").style.display = "none";
							document.getElementById("supportexpandable").style.display = "flex"
							document.getElementById("supportexpandbtn").innerHTML = `<i
							class="material-symbols-rounded">expand_circle_up</i>`;
						}


					}
				</script>
			</supportb>
			<segr>
				<div setting>
					<b>NovaOS Discord</b>
					<button style="margin-top: 5px;float: right;"
						onclick="window.open('https://discord.gg/atkqbwEQU8')">Join</button>
					<p>Join us for support, exclusive news and much more.</p>
				</div>
			</segr>
			<h3>Credits</h3>
			<table>
				<tbody style="width: 100%;">
					<tr>
						<td><b onclick="openlink('https://github.com/RoturTW')">RoturTW</b></td>
						<td>Networking</td>
					</tr>
					<tr>
						<td>Libraries</td>
						<td>
							<ul>
								<li onclick="openlink('https://fonts.google.com/')">Google Fonts</li>
								<li>FFlate</li>
							</ul>
						</td>
					</tr>
				</tbody>
			</table>
			<br>
			<small>
				Credits to all those who we couldn't mention in here.
			</small>
			<br>
		</div>
		<div id="activity" class="tabcontent advancedsettab">

			<h1><span class="material-symbols-rounded advancedsetsbackbtn" onclick="openCity(event, 'system');">
					arrow_back
				</span> Activity</h1>
			<style>
				.task {
					padding: 10px;
					background: var(--colors-BG-section);
					color: var(--colors-text-section);
					border-radius: var(--sizing-border-radius);
					margin: 5px 0;
					box-shadow: 0 3px 5px #0000007e;
				}

				.task .stpicn {
					float: right;
					transform: translateY(1px);
					cursor: pointer;
					padding: 2px;
					background: var(--colors-BG-highlighted);
					border-radius: 50%;
					color: var(--colors-special-bad);
				}

				.task small {
					display: inline-block;
					background-color: transparent;
					opacity: 0.5;
					margin: 0;
					padding: 0;
					padding-left: 5px;
				}

				@keyframes wooboo {
					0% {
						transform: scale(1);
					}

					50% {
						transform: scale(1.1);
						filter: brightness(120%);
					}

					100% {
						transform: scale(1);
					}
				}

				.wooboo-animation {
					animation: wooboo .5s infinite;
				}
			</style>
			<div id="taskslist">
				<div class="task">
					<span>Settings</span>
					<span class="material-symbols-rounded stpicn">
						do_disturb
					</span>
				</div>
			</div>
			<script>
				async function openlink(x) {
					let okay = await window.parent.justConfirm("Are you sure?", "Open " + x + " outside of NovaOS?");
					if (okay) {
						window.open(x);
					}
				}
				function taskmg() {
					const winds = window.parent.winds;
					const tasksList = document.getElementById("taskslist");
					tasksList.innerHTML = "";

					Object.keys(winds).forEach(key => {
						const taskId = key.slice(-12);
						const taskName = winds[key].title;

						const taskDiv = document.createElement("div");
						taskDiv.classList.add("task");

						const spanSettings = document.createElement("span");
						spanSettings.textContent = taskName;

						const smallId = document.createElement("small");
						smallId.textContent = taskId;

						const spanIcon = document.createElement("span");
						spanIcon.classList.add("material-symbols-rounded", "stpicn");
						spanIcon.textContent = "do_disturb";
						spanIcon.onclick = function () {
							spanIcon.classList.add('wooboo-animation');
							window.parent.clwin("window" + taskId);

						}

						taskDiv.appendChild(spanSettings);
						taskDiv.appendChild(smallId);

						taskDiv.appendChild(spanIcon);

						tasksList.appendChild(taskDiv);
					});

					// Call taskmg again after 3 seconds
					setTimeout(taskmg, 5000);
				}

			</script>
		</div>

		<div id="network" class="tabcontent">
			<h1>Networking</h1>
			<segr>
				<div setting onclick="openCity(event, 'rotursets'); loaduprtour()">
					<b>RoturTW</b>
					<button class="advancedsetsredbtn"><span class="material-symbols-rounded">
							chevron_right
						</span></button>
					<p>Configure RoturTW networking</p>
				</div>
			</segr>
		</div>
		<div id="rotursets" class="tabcontent advancedsettab">
			<h1><span class="material-symbols-rounded advancedsetsbackbtn" onclick="openCity(event, 'network');">
					arrow_back
				</span> RoturTW</h1>
			<small style="margin-bottom: 0.5rem;">Rotur is a cloudlink based standard for packet based communications,
				generally for Web OSs.</small>
			<div id="rotursettings">
				<h1>Account</h1>
				<segr id="rtrinitspace">
					<div setting class="spread">
						<b>Initialize rotur</b>
						<button onclick="initrotur()">Start</button>
					</div>
				</segr>
				<segr id="rtrsignedinsec">
					<div setting class="spread">
						<b id="rtruserstatsi">Signed in</b>
						<button onclick="window.parent.logoutofrtr()">Sign Out</button>
					</div>
				</segr>
				<segr id="rtrsignupform">
					<div setting class="formlike">
						<input id="roturaccsignname" placeholder="Enter username..." class="inputtype1" type="text">
						<input id="roturaccsignpass" placeholder="Enter your password..." class="inputtype1"
							type="password">
						<button id="rtrsigninbtn">Connecting...</button>
					</div>
				</segr>
				<script>
					function loaduprtour() {

						if (window.parent.roturExtension.loggedIn()) {
							document.getElementById("rtrinitspace").style.display = "none";
							document.getElementById("rtrsignedinsec").style.display = "block";
							document.getElementById("rtrsignupform").style.display = "none";
							document.getElementById("rtruserstatsi").innerText = "Signed in as " + window.parent.roturExtension.user.username;
						} else {
							document.getElementById("rtrsignedinsec").style.display = "none";

							document.getElementById("rtrsignupform").style.display = "none";
							document.getElementById("rtrsigninbtn").style.opacity = "0.5";
						}
					}

					async function loginrotur() {
						let targetun = document.getElementById("roturaccsignname").value;
						let targetpass = document.getElementById("roturaccsignpass").value;
						await window.parent.roturExtension.login({ USERNAME: targetun, PASSWORD: targetpass });
						document.getElementById("rtrsignedinsec").style.display = "block";
						document.getElementById("rtrsignupform").style.display = "none";
						document.getElementById("rtruserstatsi").innerText = "Signed in as " + targetun;
						window.parent.setSetting("roturLink", JSON.stringify({
							"username": targetun,
							"password": targetpass
						}));
					}
					async function initrotur() {
						let rtrstats = await window.parent.setuprotur();
						document.getElementById("rtrsignupform").style.display = "block";
						document.getElementById("rtrinitspace").style.display = "none";
						document.getElementById("rtrsigninbtn").style.opacity = "1";
						document.getElementById("rtrsigninbtn").innerText = "Login";
						document.getElementById("rtrsigninbtn").onclick = loginrotur;
					}
				</script>
				</segr>
			</div>
		</div>


		<div id="advancedthemesets" class="tabcontent advancedsettab">
			<h1><span class="material-symbols-rounded advancedsetsbackbtn" onclick="openCity(event, 'exp');">
					arrow_back
				</span> Advanced theme settings</h1>
			<h3>User Interface Colors</h3>
			<segr>
				<div setting class="colorsetting">
					<b>Primary Background</b>
					<input class="colorpickerui" id="normal-bg" data-variable="--colors-BG-normal"></input>
				</div>
				<div setting class="colorsetting">
					<b>Primary text</b>
					<input class="colorpickerui" id="text-normal" data-variable="--colors-text-normal"></input>
				</div>
			</segr>
			<segr>
				<div setting class="colorsetting">
					<b>Secondary Background</b>
					<input class="colorpickerui" id="section-bg" data-variable="--colors-BG-section"></input>
				</div>
				<div setting class="colorsetting">
					<b>Secondary text</b>
					<input class="colorpickerui" id="text-normal" data-variable="--colors-text-section"></input>
				</div>
			</segr>
			<segr>
				<div setting class="colorsetting">
					<b>Tertiary Background</b>
					<input class="colorpickerui" id="sub-bg" data-variable="--colors-BG-sub"></input>
				</div>
				<div setting class="colorsetting">
					<b>tertiary text</b>
					<input class="colorpickerui" id="text-sub" data-variable="--colors-text-sub"></input>
				</div>
			</segr>
			<segr>
				<div setting class="colorsetting">
					<b>Highlighted Background</b>
					<input class="colorpickerui" id="high-bg" data-variable="--colors-BG-highlighted"></input>
				</div>
				<div setting class="colorsetting">
					<b>Highlighted text</b>
					<input class="colorpickerui" id="text-high" data-variable="--colors-text-high"></input>
				</div>
			</segr>
			<h3>Visuals</h3>
			<segr>
				<div setting class="colorsetting">
					<span class="material-symbols-rounded">
						check_circle
					</span>
					<b>Confirm Color</b>
					<input class="colorpickerui" data-variable="--colors-special-good"></input>
				</div>
				<div setting class="colorsetting">
					<span class="material-symbols-rounded">
						cancel
					</span>
					<b>Decline Color</b>
					<input class="colorpickerui" data-variable="--colors-special-bad"></input>
				</div>

				<div setting class="colorsetting">
					<span class="material-symbols-rounded">
						rounded_corner
					</span>
					<b>Corner rounding</b>
					<input class="numinp" min="0" max="100" data-variable="--sizing-border-radius"></input>
				</div>
				<div setting class="colorsetting">
					<span class="material-symbols-rounded">
						space_dashboard
					</span>
					<b>Normal Spacing</b>
					<input class="numinp" min="0" max="100" data-variable="--spacing-normal"></input>
				</div>
				<div setting class="colorsetting">
					<span class="material-symbols-rounded">
						align_space_around
					</span>
					<b>Gap spacing</b>
					<input class="numinp" min="0" max="100" data-variable="--spacing-gap"></input>
				</div>
				<div setting class="colorsetting">
					<span class="material-symbols-rounded">
						aspect_ratio
					</span>
					<b>Normal Sizing</b>
					<input class="numinp" min="0" max="100" data-variable="--sizing-normal"></input>
				</div>
			</segr>
		</div>

		<div id="devices" class="tabcontent advancedsettab">
			<h1><span class="material-symbols-rounded advancedsetsbackbtn" onclick="openCity(event, 'system');">
					arrow_back
				</span> Devices</h1>
			<style>
				.device {
					padding: var(--sizing-normal);
					background: var(--colors-BG-section);
					color: var(--colors-text-section);
					border-radius: var(--sizing-border-radius);
					margin: 5px 0;
				}

				.device .dic {
					display: inline-grid;
					width: 30px;
					height: 30px;
					justify-content: center;
					align-items: center;
					justify-items: center;
				}

				.device .ddts {
					display: inline-block;
					width: calc(100% - 35px);
					overflow: hidden;
					white-space: nowrap;
					text-overflow: ellipsis;
				}

				.device [boo] {
					opacity: 0.7;
					overflow: hidden;
					text-wrap: nowrap;
					width: calc(100% - 20px);
					display: block;
					text-overflow: ellipsis;
				}

				.device-type {
					margin-right: 3px;
					padding-right: 3px;
					border-right: 1px solid grey;
				}

				.colorsetting {
					display: flex;
					flex-direction: row;
					justify-content: space-between;
					align-items: center;
				}
			</style>
			<div id="deviceslist">
				<div class="device">
					<div class="dic">
						<span class="material-symbols-rounded">
							refresh
						</span>
					</div>
					<div class="ddts">
						<span>Reindex Devices</span>
					</div>
					<button onclick="generateDeviceDivs()">Refresh</button>
				</div>
			</div>
			<script>
				function generateDeviceDivs() {
					const devicesListDiv = document.getElementById("deviceslist");

					navigator.mediaDevices.enumerateDevices().then(devices => {
						if (devices.length === 0) {
							devicesListDiv.innerHTML = "<p>No media devices found.</p>";
							return;
						}

						const uniqueDevices = {};

						devices.forEach(device => {
							const deviceId = device.deviceId;
							if (uniqueDevices[device.label]) {
								return;
							}

							const info = {
								id: deviceId || 'N/A',
							};

							if (device.kind === 'audioinput' && devices.some(d => d.deviceId === deviceId && d.kind === 'audiooutput')) {
								info.type = 'both';
							} else if (device.kind === 'audioinput') {
								info.type = 'microphone';
							} else if (device.kind === 'audiooutput') {
								info.type = 'speakers';
							} else if (device.kind === 'videoinput') {
								info.type = 'camera';
							}

							uniqueDevices[device.label] = info;
						});

						devicesListDiv.innerHTML = ""; // Clear previous content

						Object.keys(uniqueDevices).forEach(deviceLabel => {
							const deviceInfo = uniqueDevices[deviceLabel];

							const deviceDiv = document.createElement("div");
							deviceDiv.classList.add("device");

							const powerDiv = document.createElement("div");
							powerDiv.classList.add("dic");
							const powerIcon = document.createElement("span");
							powerIcon.classList.add("material-symbols-rounded");
							if (deviceInfo.type === 'microphone') {
								powerIcon.textContent = "mic";
							} else if (deviceInfo.type === 'camera') {
								powerIcon.textContent = "videocam";
							} else if (deviceInfo.type === 'speakers') {
								powerIcon.textContent = "volume_up";
							} else {
								powerIcon.textContent = "power_settings_new";
							}
							powerDiv.appendChild(powerIcon);


							const deviceTextDiv = document.createElement("div");
							deviceTextDiv.classList.add("ddts");
							const deviceNameSpan = document.createElement("span");
							deviceNameSpan.textContent = deviceLabel;
							deviceTextDiv.appendChild(deviceNameSpan);

							const deviceIdSpan = document.createElement("span");
							deviceIdSpan.textContent = deviceInfo.id;
							deviceIdSpan.setAttribute("boo", true);

							deviceDiv.appendChild(powerDiv);
							deviceDiv.appendChild(deviceTextDiv);
							deviceDiv.appendChild(deviceIdSpan);

							devicesListDiv.appendChild(deviceDiv);
						});
					}).catch(err => {
						devicesListDiv.innerHTML = "<p>Error enumerating devices: " + err + "</p>";
					});
				}
			</script>
		</div>

		<div id="exp" class="tabcontent">
			<h1>Display</h1>
			<segr>
				<div setting>
					<div class="checkbox-wrapper-51">
						<input type="checkbox" id="cbx-51" onclick="togglepsm()" role="submit">
						<label for="cbx-51" class="toggle">
							<span>
								<svg width="10px" height="10px" viewBox="0 0 10 10">
									<path
										d="M5,1 L5,1 C2.790861,1 1,2.790861 1,5 L1,5 C1,7.209139 2.790861,9 5,9 L5,9 C7.209139,9 9,7.209139 9,5 L9,5 C9,2.790861 7.209139,1 5,1 L5,9 L5,1 Z">
									</path>
								</svg>
							</span>
						</label>
					</div>
					<b>Power Saving Mode</b>
					<p>Dim the lights by: <input class="nocss" type="number" min=10 max=80 value="50" id="dimlightsby">%
						in this session.
					</p>

				</div>
			</segr>

			<segr>
				<div setting>
					<b>UI Size <label real="">BETA</label></b>
					<div class="UISIZEcontainer">

						<div class="UISIZEslider-labels">
							<span>small</span>
							<span>default</span>
							<span>big</span>
							<span>biggest</span>
						</div>
						<input type="range" id="UISIZErangeslid" min="-1" max="2" step="1" value="0">

					</div>
				</div>
			</segr>
			<h1>Theme</h1>
			<h3>Theme Packs</h3>
			<div class="colorpacks">

				<div id="themeslist">

				</div>

				<div class="newthemebtn" id="copy-theme-btn">
					<i class="material-symbols-rounded">content_copy</i>
				</div>
				<div class="newthemebtn" id="paste-theme-btn">
					<i class="material-symbols-rounded">content_paste</i>
				</div>
			</div>
			<segr style="margin-top: .5rem">
				<div setting onclick="window.parent.openapp('store',1, {'opener':'themes'})">
					<svg class="themestoreopner" style="float: right;" version='1.1' xmlns='http://www.w3.org/2000/svg'
						xmlns:xlink='http://www.w3.org/1999/xlink' width='53.37052' height='56.68831'
						viewBox='0,0,53.37052,56.68831'>
						<g transform='translate(-213.17634,-139.63412)'>
							<g stroke-miterlimit='10'>
								<path
									d='M241.65962,193.67156c-6.87052,-2.04166 -8.64322,-2.56843 -12.6527,-3.75991c-1.84444,-0.5481 -3.22474,-2.87978 -2.70696,-4.6222c1.16355,-3.91554 5.8018,-19.52399 7.88261,-26.52627c0.62507,-2.10345 2.29388,-3.05157 4.32482,-2.44806c6.93594,2.0611 8.93153,2.65411 12.87469,3.82587c1.74832,0.51953 3.09972,2.46721 2.43655,4.69887c-2.11127,7.10476 -6.66524,22.42961 -7.81665,26.30429c-0.51778,1.74241 -2.31527,3.12977 -4.34235,2.5274z'
									fill='#ffdd70' stroke='none' stroke-width='NaN' />
								<path
									d='M250.20411,192.35095c-6.78528,-2.3092 -8.53598,-2.905 -12.49571,-4.2526c-1.82155,-0.61992 -3.10948,-3.00388 -2.52384,-4.72468c1.31602,-3.86695 6.56207,-19.28176 8.91556,-26.19716c0.70698,-2.07736 2.41165,-2.95938 4.41738,-2.27678c6.84989,2.3312 8.82072,3.00191 12.71495,4.32722c1.72663,0.58761 3.0007,2.58673 2.25063,4.7907c-2.38794,7.01661 -7.53866,22.15133 -8.84096,25.97794c-0.58563,1.7208 -2.43608,3.03668 -4.43802,2.35537z'
									fill='#68ffee' stroke='none' stroke-width='NaN' />
								<path
									d='M239.82626,178.57165c-4.78436,1.76483 -6.0188,2.22018 -8.81085,3.25009c-1.2844,0.47377 -3.15859,-0.05508 -3.69904,-1.05991c-1.21449,-2.25805 -6.05585,-11.25924 -8.22778,-15.29737c-0.65243,-1.21304 -0.17647,-2.30561 1.2378,-2.82729c4.82992,-1.78163 6.21956,-2.29424 8.96543,-3.30711c1.21747,-0.44909 2.89315,-0.0854 3.58536,1.20157c2.20371,4.09722 6.9571,12.93488 8.15892,15.16935c0.54045,1.00483 0.20175,2.34997 -1.20982,2.87067z'
									fill='#ff816f' stroke='none' stroke-width='NaN' />
								<path
									d='M213.17634,189.28601c0,-14.65005 0,-6.12361 0,-14.67304c0,-3.93291 3.7648,-7.99489 7.48016,-7.99489c8.34913,0 23.64486,0 38.57587,0c4.48523,0 7.31449,2.71767 7.31449,7.04825c0,14.78957 0,6.73835 0,15.14636c0,3.72796 -3.02922,7.50974 -7.78782,7.50974c-15.14952,0 -29.84053,0 -38.10254,0c-3.71536,0 -7.48016,-2.71404 -7.48016,-7.03641z'
									fill='#6179ff' stroke='none' stroke-width='NaN' />
								<path
									d='M223.09877,165.70023c0,-13.0152 7.62891,-23.56611 17.03965,-23.56611c9.41073,0 17.03965,10.55091 17.03965,23.56611c0,13.0152 -34.07929,13.0152 -34.07929,0z'
									fill='none' stroke='#6179ff' stroke-width='5' />
							</g>
						</g>
					</svg>
					<span>Browse more</span>
					<p>Browse tons public theme packs</p>
				</div>
				<div setting onclick="openCity(event, 'advancedthemesets');">
					<b>Advanced theme settings</b>
					<button class="advancedsetsredbtn"><span class="material-symbols-rounded">
							chevron_right
						</span></button>
					<p>Configure UI Colors, visuals...</p>
				</div>
			</segr>
			<script>
				async function copyCurrentTheme() {
					const colorsToCopy = {};
					document.querySelectorAll('[data-variable]').forEach(button => {
						const variableName = button.dataset.variable;
						const colorValue = button.jscolor ? button.jscolor.toHEXString() : button.value;
						colorsToCopy[variableName] = colorValue;
					});
					if (await window.parent.justConfirm("Include current wallpaper?", "Include the currently set wallpaper with the theme code?")) {
						colorsToCopy['wallpaper'] = await window.parent.getSetting("wall");
					}
					window.parent.navigator.clipboard.writeText(JSON.stringify(colorsToCopy))
						.then(() => window.parent.say('Theme copied to clipboard!'))
						.catch(err => console.error('Error copying theme:', err));
				}

				async function pasteThemeFromClipboard() {
					try {
						const text = await window.parent.navigator.clipboard.readText();
						const parsedColors = JSON.parse(text);
						console.log(parsedColors)
						var variableName;

						if (typeof parsedColors === 'object' && parsedColors !== null) {
							const buttons = document.querySelectorAll('[data-variable]');
							buttons.forEach(button => {
								const variableName = button.dataset.variable;
								if (parsedColors[variableName]) {
									button.jscolor.fromString(parsedColors[variableName]);
									updateColor(button, variableName);
								}
							});
							if (await window.parent.justConfirm("Include theme wallpaper?", "Include the wallpaper included in the theme code?")) {
								document.getElementById("wallpaperurl").value = parsedColors['wallpaper'];
								savewallpap();
							}
							saveColors();
							window.parent.say('Theme applied from clipboard!');
						} else {
							window.parent.say('Clipboard does not contain a valid theme JSON.');
						}
					} catch (error) {
						console.error('Error pasting theme:', error);
						window.parent.say('Failed to apply theme from clipboard. Ensure it contains valid JSON.');
					}
				}
			</script>
			<h1>Wallpaper</h1>
			<segr>
				<div class="inpbox">
					<span>Current</span>
					<div class="inputwithbtn">
						<input placeholder="Paste a URL here..." id="wallpaperurl" class="inputtype1">
						<button onclick="savewallpap()">Save</button>
					</div>
				</div>
			</segr>

			<style>
				.colorpacks {
					display: flex;
					flex-direction: row;
					flex-wrap: nowrap;
					align-items: stretch;
					justify-content: flex-start;
					gap: 0.3rem;
					overflow-x: auto;
					padding-bottom: 0.3rem;
				}

				#themeslist {
					display: flex;
					flex-direction: row;
					gap: 0.3rem;
				}

				.newthemebtn {
					background: var(--colors-text-high);
					padding: 1.5rem;
					border-radius: 0.5rem;
					display: flex;
					align-items: center;
					justify-content: center;
				}

				#themeslist div {
					padding: 0.5rem;
					border-radius: 0.5rem;
					width: 100px;
					text-overflow: ellipsis;
					white-space: break-spaces;
					overflow: hidden;
				}

				.newthemebtn {
					background: var(--colors-BG-section);
					color: var(--colors-text-section);
					padding: 1.5rem;
					border-radius: 0.5rem;
					display: flex;
					align-items: center;
					justify-content: center;
					color: var(--colors-text-high);
					text-shadow: 0 0 9px var(--colors-BG-highlighted);
					border: 1px solid var(--colors-BG-sub);
				}

				.newthemebtn i {
					font-size: 1.5rem;
				}

				label[real] {
					font-size: var(--font-size-small);
					background-color: rgb(139 62 62);
					color: white;
					border-radius: 5px;
					padding: 3px 5px;
					margin-left: 5px;
				}

				.jscolor {
					width: 7rem;
					height: 35px;
					border-radius: var(--sizing-border-radius);
					font-family: monospace;
					font-size: var(--font-size-default);
					background-color: var(--colors-BG-normal);
					border: 0;
					color: var(--colors-text-normal);
				}

				/* Styles for the color picker itself */
				.jscolor-palette {
					background: #333;
					border: 1px solid #555;
				}

				/* Styles for the color palette elements */
				.jscolor-palette .jscolor-palette-cell {
					border: 1px solid #444;
				}

				/* Styles for the color picker input */
				.jscolor-picker {
					background: #222;
					color: #ddd;
					border: 1px solid #444;
				}

				/* Adjust color of the text and input areas */
				.jscolor-input {
					background: #333;
					color: #eee;
				}

				/* Additional adjustments for hover and focus states */
				.jscolor-picker:hover,
				.jscolor-picker:focus {
					border-color: #777;
				}

				.jscolor-palette-cell:hover {
					background: #444;
				}

				.numinp {
					width: 7rem;
					border-radius: var(--sizing-border-radius);
					min-width: 0;
					border: 0;
					background-color: var(--colors-BG-normal);
					color: var(--colors-text-normal);
					padding: 0.3rem;
					text-align: center;
				}
			</style>


			<script>
				window.parent.fetch('testsss/themes.json')
					.then(response => response.json())
					.then(data => {
						const container = document.getElementById("themeslist");

						Object.entries(data).forEach(([themeName, themeData]) => {
							const div = document.createElement('div');
							div.style.background = `linear-gradient(to bottom right, 
							${themeData.colors["--colors-BG-normal"]} 0%, 
							${themeData.colors["--colors-BG-sub"]} 25%, 
							${themeData.colors["--colors-BG-section"]} 75%, 
							${themeData.colors["--colors-BG-highlighted"]}) 100%`;
							div.style.color = themeData.colors["--colors-text-normal"];
							div.style.border = `2px solid ${themeData.colors["--colors-BG-sub"]}`;
							div.innerText = themeName;
							div.addEventListener('click', () => applyTheme(themeData));
							container.appendChild(div);
						});
					})
					.catch(error => console.error('Error loading themes:', error));

				function initColorPickers() {
					document.querySelectorAll('[data-variable]').forEach(button => {
						const variableName = button.dataset.variable;
						if (button.classList.contains('colorpickerui')) {
							button.jscolor = new jscolor(button, {
								preset: 'dark',
								width: 150,
								paletteCols: 0,
								onInput: () => debouncedSaveColor(button, variableName)
							});
							button.jscolor.fromString(getCSSVariableValue(variableName));
						} else {
							button.value = (getCSSVariableValue(variableName));
							button.addEventListener('input', () => debouncedSaveColor(button, variableName));
						}
					});
				}

				const debouncedSaveColor = debounce((picker, variableName) => {
					updateColor(picker, variableName);
					saveColors();
				}, 300);

				async function saveColors() {
					const colorsToSave = {};
					const buttons = document.querySelectorAll('[data-variable]');
					buttons.forEach(button => {
						const variableName = button.dataset.variable;
						const colorValue = button.jscolor ? button.jscolor.toHEXString() : button.value;

						colorsToSave[variableName] = colorValue;
					});
					await window.parent.setSetting("themeColors", colorsToSave);
				}

				function applyTheme(data) {
					const buttons = document.querySelectorAll('[data-variable]');
					buttons.forEach(button => {
						const variableName = button.dataset.variable;
						const newColor = data.colors[variableName];
						if (newColor) {
							button.jscolor.fromString(newColor);
							updateColor(button, variableName);
						}
					});

					saveColors();
				}

				function updateColor(picker, variableName) {
					const colorValue = picker.jscolor ? picker.jscolor.toHEXString() : picker.value;
					window.parent.document.documentElement.style.setProperty(variableName, colorValue);
					document.documentElement.style.setProperty(variableName, colorValue);
				}

				function getCSSVariableValue(varName) {
					return window.parent.getComputedStyle(window.parent.document.documentElement).getPropertyValue(varName).trim();
				}

				function applyTheme(data) {
					const inputs = document.querySelectorAll('[data-variable]');
					inputs.forEach(input => {
						const variableName = input.dataset.variable;
						const newValue = data.colors[variableName];

						if (newValue !== undefined) {
							if (input.classList.contains('colorpickerui')) {
								input.jscolor.fromString(newValue);
								updateColor(input, variableName);
							} else if (input.classList.contains('numinp')) {
								input.value = newValue;
								document.documentElement.style.setProperty(variableName, newValue + 'px');
							}
						}
					});

					saveColors();
				}

				function debounce(func, wait) {
					let timeout;
					return function (...args) {
						clearTimeout(timeout);
						timeout = setTimeout(() => func.apply(this, args), wait);
					};
				}
				window.addEventListener('load', initColorPickers);
			</script>
			<style>
				.inputwithbtn {
					width: 100%;
					display: flex;
					flex-direction: row;
					gap: 0.5rem;
					margin-top: 0.5rem;
				}

				input.inputtype1 {
					background-color: var(--colors-BG-normal);
					color: var(--colors-text-normal);
					flex: 1;
					border: none;
					padding: var(--sizing-nano) var(--sizing-normal);
					border-radius: var(--sizing-border-radius);
				}

				#UISIZErangeslid {
					width: 79%;
					height: 2px;
					display: block;
					margin: var(--sizing-normal) auto;
					margin-top: var(--sizing-huge);
				}

				.UISIZEslider-labels {
					display: flex;
					justify-content: space-between;
					width: 100%;
					margin-top: var(--sizing-normal);
				}

				.UISIZEslider-labels span {
					opacity: 0.5;
					font-size: var(--font-size-small);
					width: 0;
					text-align: center;
					flex: 1;
				}
			</style>
			</segr>
			<script defer>
				async function savewallpap() {
					var newurl = document.getElementById("wallpaperurl");
					await window.parent.setSetting("wall", newurl.value);
					setTimeout(() => { window.parent.dod() }, 1000)

				}
				function openCity(evt, cityName) {
					currentpage = cityName;
					var i, tabcontent, tablinks;
					tabcontent = document.getElementsByClassName("tabcontent");
					for (i = 0; i < tabcontent.length; i++) {
						tabcontent[i].style.display = "none";
					}
					tablinks = document.getElementsByClassName("tablinks");
					for (i = 0; i < tablinks.length; i++) {
						tablinks[i].className = tablinks[i].className.replace(" active", "");
					}
					document.getElementById(cityName).style.display = "block";
					evt.currentTarget.className += " active";
				}

				var usedMemoryPercentage;
				document.getElementById("defaultOpen").click();

				if ('storage' in navigator && 'estimate' in navigator.storage) {
					navigator.storage.estimate().then(({ usage, quota }) => {

						const elem = document.getElementById("myBar2");
						const storemarkElem = document.getElementById("storemark2");

						// Calculate used memory percentage
						const usedMemoryPercentage = (usage / quota) * 100;
						elem.style.width = usedMemoryPercentage + "%";

						// Convert total and used memory to GB and MB
						const totalMemoryGB = (quota / (1024 * 1024 * 1024)).toFixed(2);
						const usedMemoryGB = (usage / (1024 * 1024 * 1024)).toFixed(2);
						const totalMemoryMB = (quota / (1024 * 1024)).toFixed(2);
						const usedMemoryMB = (usage / (1024 * 1024)).toFixed(2);

						// Display memory usage
						storemarkElem.textContent = `Used ${usedMemoryGB} GB (${usedMemoryMB} MB) of available ${totalMemoryGB} GB (${totalMemoryMB} MB)`;
						let strgsugs = document.getElementById("storagesuggs");
						if (usedMemoryPercentage < 20) {
							strgsugs.innerHTML = `<small><b>You have a lot of storage left!</b><p>You can import files in files app or install apps from store to use it!</p></small>`
						}
					});
				}

				generateDeviceDivs()


				var psmm = window.parent.document.body.style.opacity == "1";
				if (psmm) { togglepsm() }
				function togglepsm() {
					if (psmm) {
						window.parent.document.body.style.filter = "brightness(1)"
						psmm = false
					} else {
						window.parent.document.body.style.filter = "brightness(" + (100 - document.getElementById("dimlightsby").value) + "%)"

						psmm = true;
						document.getElementById("cbx-51").check()
					}
				}

			</script>
	</container>
</body>

</html>